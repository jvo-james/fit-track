<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FitTrack | Dashboard</title>
  <!-- Google Fonts & FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <script defer src="https://kit.fontawesome.com/a2e8f1b6b1.js"></script>
   <!-- Google Fonts & FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <script defer src="https://kit.fontawesome.com/a2e8f1b6b1.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="storage.js"></script>


  <style>
  :root {
    --bg: #000;
    --gold: #ff9800;
    --white: #fff;
    --font-base: 'Raleway', sans-serif;
    --font-head: 'Poppins', sans-serif;
    --transition: .3s ease;
    --sidebar-w: 80px;
    --mobile-sidebar-w: 200px;
    --header-z: 200;
    --overlay-z: 90;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    display:flex; min-height:100vh;
    background:var(--bg); color:var(--white);
    font-family:var(--font-base); overflow-x:hidden;
  }
  a { color:inherit; text-decoration:none; }
  button { font-family:var(--font-head); background:transparent; border:none; color:var(--white); cursor:pointer; transition:var(--transition); }

  /* ─── OVERLAY ───────────────── */
  #overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.5);
    opacity:0; visibility:hidden; transition:opacity var(--transition);
    z-index:var(--overlay-z);
  }
  #overlay.active { opacity:1; visibility:visible; }

  /* ─── SIDEBAR ───────────────── */
  aside.sidebar {
    width:var(--sidebar-w); background:rgba(0,0,0,0.9); border-right:2px solid var(--gold);
    display:flex; flex-direction:column; align-items:center; padding-top:1rem;
    position:sticky; top:0; height:100vh;
    transform:translateX(0); transition:transform var(--transition);
    z-index:var(--sidebar-z);
  }
  aside.sidebar.open { transform:translateX(0); }
  .sidebar-close { display:none; }
  .sidebar .logo { font-size:1.6rem; color:var(--gold); margin-bottom:1.5rem; }
  .sidebar .menu-item { width:100%; padding:.8rem 0; text-align:center; font-size:.75rem; color:var(--white); }
  .sidebar .menu-item i { display:block; font-size:1.2rem; margin-bottom:.2rem; }
  .sidebar .menu-item.active,
  .sidebar .menu-item:hover { background:rgba(255,152,0,0.2); }
  .sidebar-close { display:block; position:absolute; top:1rem; right:1rem; font-size:1.5rem; }

  /* ─── HEADER ───────────────── */
  header {
    display:flex; align-items:center; justify-content:space-between;
    padding:1rem 1.5rem; background:rgba(0,0,0,0.9);
    border-bottom:2px solid var(--gold);
    position:sticky; top:0; left:0; right:0; z-index:var(--header-z);
  }
  .hamburger, .profile-btn { display:none; font-size:1.4rem; color:var(--white); }
  .header-left { display:flex; align-items:center; gap:.75rem; }
  .header-left i { font-size:1.5rem; color:var(--gold); }
  .header-left .title { font-size:1.5rem; font-weight:700; }
  .header-right { display:flex; align-items:center; gap:1rem; }
  .header-right input {
    background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.3);
    border-radius:6px; padding:.4rem .8rem; color:var(--white);
    font-size:.9rem; width:140px;
  }
  .header-right .icon-btn { font-size:1.2rem; background:rgba(255,152,0,0.2); border-radius:50%; padding:.3rem; }

  /* ─── MAIN LAYOUT ───────────────── */
  .main { flex:1; display:flex; flex-direction:column; }
  .content { padding:1rem 1.5rem; flex:1; overflow-y:auto; }

  /* ─── PROFILE SNAPSHOT ───────────────── */
  .profile-snap {
    display:flex; align-items:center; gap:1rem; margin-bottom:1.5rem;
    background:rgba(255,255,255,0.05); padding:1rem; border-radius:8px;
  }
  .profile-snap img { width:60px; height:60px; border-radius:50%; object-fit:cover; }
  .profile-snap .info { flex:1; }
  .profile-snap .info h3 { margin-bottom:.25rem; }
  .profile-snap .info p { font-size:.9rem; opacity:.8; }

  /* ─── SUMMARY GRID ───────────────── */
  .summary-grid {
    display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
    gap:1rem; margin-bottom:1.5rem;
  }
  .summary-card {
    background:rgba(255,255,255,0.05); border-radius:8px; padding:1rem;
    text-align:center; transition:var(--transition);
  }
  .summary-card:hover { background:rgba(255,255,255,0.1); }
  .summary-card i { font-size:1.4rem; color:var(--gold); margin-bottom:.4rem; }
  .summary-card .value { font-size:1.2rem; margin:0.3rem 0; }
  .summary-card .label { font-size:.85rem; opacity:.8; }

  /* ─── RECOMMENDED ROUTINES ───────────────── */
  .recommended {
    margin-bottom:1.5rem;
  }
  .recommended h3 { display:flex; align-items:center; gap:.5rem; color:var(--gold); margin-bottom:.75rem; }
  .recommended .card-list {
    display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:1rem;
  }
  .recommended .card {
    background:rgba(255,255,255,0.05); border-radius:8px; padding:1rem;
    display:flex; flex-direction:column; justfiy-content:space-between;
  }
  .recommended .card h4 { margin-bottom:.5rem; font-size:1rem; }
  .recommended .card p { flex:1; font-size:.9rem; opacity:.8; }
  .recommended .card button {
    margin-top:.5rem; background:var(--gold); color:var(--bg); padding:.4rem; border-radius:6px;
  }

  /* ─── CHARTS ───────────────── */
  .charts { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:1rem; margin-bottom:1.5rem; }
  .chart-card {
    background:rgba(255,255,255,0.05); border-radius:8px; padding:1rem;
  }
  .chart-card h3 { display:flex; align-items:center; gap:.5rem; margin-bottom:.75rem; color:var(--gold); }
  .chart-card canvas { width:100% !important; height:200px !important; }

  /* ─── ACTION PANELS ───────────────── */
  .actions-grid {
    display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:1rem; margin-bottom:1.5rem;
  }
  .action-card {
    background:rgba(255,255,255,0.05); border-radius:8px; padding:1rem;
  }
  .action-card h3 { font-size:1rem; margin-bottom:.5rem; display:flex; align-items:center; gap:.5rem; color:var(--gold); }
  .action-card ul { list-style:none; padding-left:1rem; max-height:120px; overflow-y:auto; }
  .action-card ul li { margin-bottom:.4rem; font-size:.9rem; }
  .action-card button { margin-top:.5rem; background:var(--gold); color:var(--bg); padding:.4rem; border-radius:6px; width:100%; }

  /* ─── FOOTER ───────────────── */
  footer { text-align:center; padding:1rem 0; border-top:1px solid rgba(255,255,255,0.2); font-size:.9rem; opacity:.6; }

  /* ─── RESPONSIVE ───────────────── */
  @media (max-width:600px) {
    aside.sidebar {
      position:fixed; top:0; bottom:0; left:0;
      width:var(--mobile-sidebar-w); transform:translateX(-100%);
    }
    aside.sidebar.open { transform:translateX(0); }
    .sidebar-close { display:block; }
    header { padding:.8rem 1rem; }
    .hamburger, .profile-btn {
      display:block; position:absolute; top:50%; transform:translateY(-50%);
      font-size:1.2rem; background:transparent; border:none; z-index:var(--header-z);
    }
    .hamburger { left:1rem; }
    .profile-btn { right:1rem; }
    .header-right { display:none; }
    header h1 { margin:0 auto; font-size:1.1rem; }
    .content { padding:.8rem 1rem; }
    .charts, .actions-grid { grid-template-columns:1fr; }
    .recommended .card-list { grid-template-columns:1fr; }
    body { padding-bottom: env(safe-area-inset-bottom); }
  }
  </style>
</head>

<body>
  <div id="overlay"></div>

  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar">
    <button id="sidebar-close" class="sidebar-close">&times;</button>
    <div class="logo"><i class="fas fa-heartbeat"></i></div>
    <a href="dashboard.html" class="menu-item active"><i class="fas fa-tachometer-alt"></i>Dashboard</a>
    <a href="log.html"       class="menu-item"><i class="fas fa-pen"></i>Log</a>
    <a href="workouts.html"  class="menu-item"><i class="fas fa-dumbbell"></i>Workouts</a>
    <a href="leaderboard.html" class="menu-item"><i class="fas fa-trophy"></i>Board</a>
    <button class="menu-item profile-menu"><i id="side-avatar" class="fas fa-user-circle avatar"></i>Profile</button>
    <a href="signout.html" class="menu-item sign-out"><i class="fas fa-sign-out-alt"></i>Sign Out</a>
  </aside>

  <div class="main">
    <!-- HEADER -->
    <header>
      <button id="hamburger" class="hamburger"><i class="fas fa-bars"></i></button>
      <div class="header-left">
        <i class="fas fa-chart-pie"></i>
        <span class="title">Dashboard</span>
      </div>
      <div class="header-right">
        <input type="text" placeholder="Search…"/>
        <button class="icon-btn"><i class="fas fa-bell"></i></button>
        <button id="profile-btn" class="profile-btn"><i class="fas fa-user-circle"></i></button>
      </div>
    </header>

    <div class="content">
      <!-- PROFILE SNAPSHOT -->
      <section class="profile-snap">
        <img id="snap-avatar" src="" alt="Avatar"/>
        <div class="info">
          <h3 id="snap-name">Hello, User!</h3>
          <p id="snap-joined">Member since —</p>
        </div>
      </section>

      <!-- SUMMARY GRID -->
      <section class="summary-grid">
        <div class="summary-card"><i class="fas fa-dumbbell"></i><div class="value" id="sum-workouts">0</div><div class="label">This Month</div></div>
        <div class="summary-card"><i class="fas fa-route"></i><div class="value" id="sum-distance">0 km</div><div class="label">Distance</div></div>
        <div class="summary-card"><i class="fas fa-fire"></i><div class="value" id="sum-calories">0</div><div class="label">Calories</div></div>
        <div class="summary-card"><i class="fas fa-calendar-day"></i><div class="value" id="sum-days">0</div><div class="label">Active Days</div></div>
      </section>

      <!-- RECOMMENDED ROUTINES -->
      <section class="recommended">
        <h3><i class="fas fa-lightbulb"></i> Recommended for You</h3>
        <div class="card-list" id="reco-list">
          <!-- JS injected -->
        </div>
      </section>

      <!-- CHARTS -->
      <section class="charts">
        <div class="chart-card"><h3><i class="fas fa-chart-line"></i> Weekly Activity</h3><canvas id="chart-activity"></canvas></div>
        <div class="chart-card"><h3><i class="fas fa-chart-pie"></i> Workout Breakdown</h3><canvas id="chart-distrib"></canvas></div>
      </section>

      <!-- ACTION PANELS -->
      <section class="actions-grid">
        <div class="action-card">
          <h3><i class="fas fa-flag-checkered"></i> My Challenges</h3>
          <ul id="act-challenges"></ul>
        </div>
        <div class="action-card">
          <h3><i class="fas fa-trophy"></i> Leaderboard</h3>
          <ul id="act-leaderboard"></ul>
        </div>
        <div class="action-card">
          <h3><i class="fas fa-users"></i> Community Feed</h3>
          <ul id="act-feed"></ul>
        </div>
      </section>

      <footer>
        &copy; 2025 FitTrack • <a href="profile.html">My Profile</a> • <a href="help.html">Help Center</a>
      </footer>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded',()=>{
    // pull in data
    const pro = JSON.parse(localStorage.getItem('ft_profile')||'{}'),
          acts = JSON.parse(localStorage.getItem('ft_activities')||'[]'),
          chs  = JSON.parse(localStorage.getItem('ft_challenges')||'[]'),
          lb   = JSON.parse(localStorage.getItem('ft_leaderboard')||'[]'),
          fd   = JSON.parse(localStorage.getItem('ft_feed')||'[]'),
          plans= JSON.parse(localStorage.getItem('ft_plans')||'[]'),
          routines = [
            {id:1,title:'Full-Body HIIT',desc:'Fast-paced intervals to torch calories.'},
            {id:2,title:'Morning Yoga Flow',desc:'Gentle wake-up sequences.'},
            {id:3,title:'Upper Body Strength',desc:'Build arm & chest power.'}
          ];

    // PROFILE SNAPSHOT
    document.getElementById('snap-name').textContent = pro.name ? `Hello, ${pro.name}` : 'Welcome!';
    document.getElementById('snap-joined').textContent = pro.joined ? `Member since ${pro.joined}` : '';
    const av = document.getElementById('snap-avatar');
    if(pro.avatar) av.src = pro.avatar; else av.src = 'default-avatar.png';

    // SUMMARY
    const thisMonth = acts.filter(a=>{
      const d=new Date(a.date),n=new Date();
      return d.getMonth()===n.getMonth()&&d.getFullYear()===n.getFullYear();
    }).length;
    const dist = acts.reduce((s,a)=>s+(parseFloat(a.distance)||0),0).toFixed(1);
    const cal  = acts.reduce((s,a)=>s+(parseFloat(a.calories)||0),0);
    const days = [...new Set(acts.map(a=>a.date))].length;
    document.getElementById('sum-workouts').textContent=thisMonth;
    document.getElementById('sum-distance').textContent=dist+' km';
    document.getElementById('sum-calories').textContent=cal;
    document.getElementById('sum-days').textContent=days;

    // RECOMMENDED ROUTINES
    const recoEl = document.getElementById('reco-list');
    routines.filter(r=>!plans.includes(r.id)).forEach(r=>{
      const d=document.createElement('div'); d.className='card';
      d.innerHTML=`
        <h4>${r.title}</h4>
        <p>${r.desc}</p>
        <button onclick="startRoutine(${r.id})">Start</button>`;
      recoEl.append(d);
    });
    window.startRoutine = id=>{
      alert('Starting routine ID '+id);
    };

    // CHARTS data
    const last7 = Array.from({length:7}).map((_,i)=>{
      const d=new Date(); d.setDate(d.getDate()-(6-i));
      return d.toISOString().slice(5,10);
    });
    const activityData = last7.map(day=> acts.filter(a=>a.date.slice(5)===day).reduce((s,a)=>s+(+a.duration||0),0) );
    const typeDist = ['HIIT','Yoga','Strength','Other'].map(cat=>
      acts.filter(a=>a.type.includes(cat)).length
    );
    new Chart(document.getElementById('chart-activity'),{
      type:'line',
      data:{labels:last7,datasets:[{data:activityData,label:'Mins',borderColor:'#ff9800',backgroundColor:'rgba(255,152,0,0.2)',fill:true,tension:.3}]},
      options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}}}
    });
    new Chart(document.getElementById('chart-distrib'),{
      type:'pie',
      data:{labels:['HIIT','Yoga','Strength','Other'],datasets:[{data:typeDist,backgroundColor:['#ff9800','#4caf50','#03a9f4','#9e9e9e']}]},
      options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}}}
    });

    // ACTION PANELS
    const chUL=document.getElementById('act-challenges');
    chs.forEach(c=> chUL.innerHTML+=`<li>${c.text||c.q}</li>`);

    const lbUL=document.getElementById('act-leaderboard');
    lb.forEach(u=> lbUL.innerHTML+=`<li>${u.name}: ${u.score}</li>`);

    const fdUL=document.getElementById('act-feed');
    fd.forEach(p=> fdUL.innerHTML+=`<li>${p}</li>`);

    // Sidebar toggle
    document.getElementById('hamburger').onclick = ()=>{
      document.querySelector('aside.sidebar').classList.add('open');
      document.getElementById('overlay').classList.add('active');
    };
    document.getElementById('sidebar-close').onclick =
    document.getElementById('overlay').onclick = ()=>{
      document.querySelector('aside.sidebar').classList.remove('open');
      document.getElementById('overlay').classList.remove('active');
    };

    // Profile nav
    document.getElementById('profile-btn').onclick =
      document.querySelector('.profile-menu').onclick =
        ()=> location.href='profile.html';
  });
  </script>
</body>
</html>
