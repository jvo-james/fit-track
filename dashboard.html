<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>FitTrack | Dashboard</title>

  <!-- Google Fonts, FontAwesome, Animate.css, Chart.js, Storage Helper -->
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <script defer src="https://kit.fontawesome.com/a2e8f1b6b1.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="storage.js"></script>

</head>
<style>
    :root {
      --bg: #000;
      --gold: #ff9800;
      --white: #fff;
      --dark-gray: #222;
      --light-gray: #eee;
      --font-base: 'Raleway', sans-serif;
      --font-head: 'Poppins', sans-serif;
      --transition: .3s ease;
      --sidebar-w: 80px;
      --mobile-break: 600px;
      --z-overlay: 90;
      --z-sidebar: 100;
      --z-header: 200;
      --mobile-w: 240px;
    }
    
    * { margin:0; padding:0; box-sizing:border-box; }
    
    body {
      display:flex; min-height:100vh;
      background:var(--bg); color:var(--white);
      font-family:var(--font-base); overflow-x:hidden;
    }
    a { color:inherit; text-decoration:none; }

    /* Notification */
    .notif-bar {
      position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
      background:#fff; color:#000;
      border-left:4px solid var(--gold);
      padding:.8rem 1.2rem; border-radius:8px;
      display:flex; justify-content:space-between; align-items:center;
      gap:.5rem; font-size:.9rem; z-index:3000;
    }
    .notif-bar.hidden { display:none; }
    .notif-bar a { color:var(--gold); font-weight:600; }
    .notif-bar button {
      background:none; border:none; font-size:1.2rem; color:#000;
      cursor:pointer;
    }

    /* Pseudo-toast */
    .pseudo-toast {
      position:fixed; top:80px; right:20px;
      background:#fff; color:#000;
      border-left:4px solid var(--gold);
      padding:1rem; border-radius:6px;
      box-shadow:0 4px 12px rgba(0,0,0,0.3);
      max-width:280px; font-size:.9rem;
      display:none; z-index:3000;
      animation:fadeInDown .5s;
    }
    .pseudo-toast.active { display:block; }
    @keyframes fadeInDown {
      from { opacity:0; transform:translateY(-20px); }
      to { opacity:1; transform:translateY(0); }
    }
    .pseudo-toast a { color:var(--gold); font-weight:600; text-decoration:underline; }

    /* Overlay (for sidebar & modal) */
    .overlay {
      display:none; position:fixed; inset:0;
      background:rgba(0,0,0,0.5); z-index:var(--z-overlay);
    }
    .overlay.active { display:block; }
/* The transparent overlay that closes the sidebar on tap */
#overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  z-index: 100;
}
#overlay.active {
  display: block;
}

    /* SIDEBAR */
    .sidebar {
      width:var(--sidebar-w);
      background:rgba(0,0,0,0.9);
      border-right:2px solid var(--gold);
      display:flex; flex-direction:column; align-items:center;
      padding:1rem 0; position:sticky; top:0; height:100vh;
      z-index:var(--z-sidebar);
    }
   .sidebar {

  z-index: 1000; 
}
@media(max-width:600px){
  .sidebar {
    position: fixed;
    left: -100%;
    width: var(--mobile-w);
    z-index: 1000; /* also here */
  }
  .sidebar.open {
    left: 0;
  }
}

     
    .sidebar .logo { font-size:1.8rem; color:var(--gold); margin-bottom:2rem; }
    .sidebar a.menu-item, .sidebar button.profile-menu {
      width:100%; padding:.8rem 0;
      display:flex; flex-direction:column; align-items:center; gap:.3rem;
      background:transparent; border:none; color:var(--white);
      transition:background var(--transition);
    }
    .sidebar a.menu-item.active,
    .sidebar a.menu-item:hover,
    .sidebar button.profile-menu:hover {
      background:rgba(255,152,0,0.2);
    }
    .sidebar a.menu-item i,
    .sidebar button.profile-menu i.avatar { font-size:1.4rem; }
    .sidebar a.menu-item span,
    .sidebar button.profile-menu span   { font-size:.75rem; }
    .sidebar a.sign-out { margin-top:auto; margin-bottom:1rem!important; }
    img.avatar, i.avatar {
      width:32px; height:32px; border-radius:50%;
      object-fit:cover; border:2px solid var(--white);
    }
    /* Main & header */
    .main {
      flex:1; display:flex; flex-direction:column;
      margin-left:calc(var(--sidebar-w)-2px);
    }

    @media (max-width: 600px) {
      .main { margin-left:0; }
      .sidebar {
        position: fixed;
        left: -100%;
        width: var(--mobile-w);
        z-index: var(--z-sidebar);
      }
      .sidebar.open { left: 0; }
      /* show hamburger & profile buttons on mobile */
      .hamburger, .profile-btn { display: block; position: fixed; top: 1rem; }
      .hamburger { left: 1rem; }
      .profile-btn { right: 1rem; }
      header h1 { margin: 0 auto; }
    }
    header {
      display: flex; align-items: center; justify-content: space-between;
      padding:1rem 1.5rem;
      background:linear-gradient(135deg,#111,#222);
      box-shadow:0 4px 12px rgba(0,0,0,0.7);
      border-bottom:2px solid var(--gold);
      position:sticky; top:0; z-index:var(--z-header);
    }
    .hamburger, .profile-btn {
      display:none; background:transparent; border:none;
      color:var(--white); font-size:1.5rem; cursor:pointer;
    }
   @media (max-width: 600px) {
  .hamburger, .profile-btn {
    display: block;
    position: fixed;
    top: 1rem;
  }
  .hamburger { left: 1rem; }
  .profile-btn { right: 1rem; }
  header h1 { margin: 0 auto; }
}
    /* hide sidebar-close on desktop */
#sidebar-close {
  display: none;
}

/* show it under 600px only */
@media (max-width: 600px) {
  #sidebar-close {
    display: block;
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: transparent;
    color: var(--white);
    font-size: 1.5rem;
    border: none;
    cursor: pointer;
  }
}


header h1 { margin:0 auto; }
    
    header h1 {
      font-size:1.6rem; flex:1; text-align:center;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .new-workout {
      display:flex; align-items:center; gap:.4rem; background:var(--gold);
      color:var(--bg); padding:.6rem 1rem; border-radius:30px;
    }
@media (max-width: 600px) {
  header h1 {
    font-size: 1.2rem;
  }
  /* hide the ‚ÄúNew Workout‚Äù text, leave just the plus icon */
  .new-workout span { display: none; }
  .new-workout { padding: 0.4rem; }
  /* hide the top-right profile avatar on super small */
  #profile-btn { display: none; }
}
 @media(max-width:600px) {
      .sidebar {
        position: fixed;
        left: -100%;
        top: 0;
        height: 100vh;
        transition: left var(--transition);
        z-index: var(--z-sidebar);
      }
      .sidebar.open {
        left: 0;
      }
    }
    /* Profile summary */
    .profile-summary {
      display:flex; align-items:center; gap:1rem;
      padding:1rem 1.5rem; background:rgba(255,255,255,0.05);
    }
    .profile-summary img {
      width:48px; height:48px; border-radius:50%; object-fit:cover;
      border:2px solid var(--gold);
    }
    .profile-summary span {
      font-size:1.1rem; font-weight:600;
    }

    /* Content grid */
    .content {
      padding:1rem 1.5rem; overflow-y:auto;
      display:grid; gap:1.5rem;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
    }

    /* Stats */
    .stats { grid-column:1/-1; display:grid; gap:1rem;
      grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
    }
    .stat-card {
      background:rgba(255,255,255,0.05);
      border-radius:8px; padding:1rem; text-align:center;
      transition:background var(--transition);
    }
    .stat-card:hover { background:rgba(255,255,255,0.1); }
    .stat-card i { font-size:1.4rem; color:var(--gold); margin-bottom:.4rem; }
    .stat-card h3 { font-size:1.2rem; margin-bottom:.3rem; }
    .stat-card p { font-size:.85rem; opacity:.8; }

    /* Progress & Goals */
    .progress, .goals { grid-column:1/-1; }
    .progress h3 {
      color:var(--gold); margin-bottom:.5rem; display:flex; align-items:center; gap:.5rem;
    }
    .bar-container {
      background:rgba(255,255,255,0.2); border-radius:6px; overflow:hidden; height:12px;
    }
    .bar-fill { width:0; height:100%; background:var(--gold); transition:width 1s ease; }

    .goals { display:grid; gap:1rem; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); }
    .goal-card {
      background:rgba(255,255,255,0.05); border-radius:8px; padding:.8rem;
    }
    .goal-card p { font-size:.85rem; margin-bottom:.4rem; }
    .goal-container {
      background:rgba(255,255,255,0.2); border-radius:6px; overflow:hidden; height:8px;
    }
    .goal-fill { width:0; height:100%; background:var(--gold); transition:width 1s ease; }

    /* Charts */
    .charts {
      grid-column:1/-1; display:grid; gap:1rem;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
    }
    .chart-card {
      background:rgba(255,255,255,0.05);
      border-radius:8px; padding:1rem; position:relative; height:300px;
    }
    .chart-card h3 {
      color:var(--gold); margin-bottom:.5rem; display:flex; align-items:center; gap:.5rem;
    }
    .chart-card canvas {
      position:absolute; top:2.5rem; left:1rem; right:1rem; bottom:1rem;
    }

    /* Recent Activities */
    .quick-log {
      grid-column:1/-1; background:rgba(255,255,255,0.05);
      padding:1rem; border-radius:8px;
    }
    .quick-log h2 {
      display:flex; align-items:center; gap:.5rem; font-size:1.1rem; color:var(--gold);
      margin-bottom:.6rem;
    }
    .quick-log table {
      width:100%; border-collapse:collapse; margin-bottom:.8rem;
    }
    .quick-log th, .quick-log td {
      padding:.4rem; text-align:left;
      border-bottom:1px solid rgba(255,255,255,0.2);
      font-size:.85rem;
    }
    .fast-stats { display:flex; gap:1.5rem; font-size:.85rem; }
    .fast-stats strong { color:var(--gold); }

    /* Tip of the Day */
    .daily-tip {
      grid-column:1/-1; background:rgba(255,255,255,0.05);
      padding:1rem; border-radius:8px;
    }
    .daily-tip h2 {
      display:flex; align-items:center; gap:.5rem;
      font-size:1.1rem; color:var(--gold); margin-bottom:.5rem;
    }
    .daily-tip p { font-size:.9rem; line-height:1.4; opacity:.8; }

    /* Upcoming Live Sessions */
    .live-sessions {
      grid-column:1/-1; margin-top:1rem;
    }
    .live-sessions h2 {
      display:flex; align-items:center; gap:.5rem;
      font-size:1.1rem; color:var(--gold); margin-bottom:.6rem;
    }
    .live-grid {
      display:grid; gap:.75rem;
      grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
    }
    .live-card {
      background:rgba(255,255,255,0.05); border-radius:8px;
      padding:.75rem; text-align:center;
      transition:transform var(--transition),box-shadow var(--transition);
    }
    .live-card:hover {
      transform:translateY(-4px);
      box-shadow:0 4px 12px rgba(0,0,0,0.4);
    }
    .live-card img {
      width:100%; height:80px; object-fit:cover;
      border-radius:6px; margin-bottom:.5rem;
    }
    .live-card h3 { font-size:.95rem; margin-bottom:.25rem; }
    .live-card p { font-size:.8rem; opacity:.7; }
    .live-card button {
      padding:.5rem 1rem; margin-top:.5rem; font-size:.85rem;
      background:var(--gold); color:var(--bg); border:none; border-radius:20px;
      cursor:pointer;
    }

    /* Top‚ÄØ5 Leaderboard */
    .mini-board {
      grid-column:1/-1; background:rgba(255,255,255,0.05);
      padding:1rem; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.5);
    }
    .mini-board h2 {
      display:flex; align-items:center; gap:.5rem;
      font-size:1.1rem; color:var(--gold); margin-bottom:.6rem;
    }
    .mini-board ol {
      list-style:none; padding:0; margin:0;
    }
    .mini-board li {
      background:rgba(255,255,255,0.1); padding:.6rem; border-radius:6px;
      display:flex; justify-content:space-between; margin-bottom:.4rem;
      font-size:.9rem;
    }

    /* Achievements */
    .top-achievements { grid-column:1/-1; margin-top:1rem; }
    .top-achievements h2 {
      display:flex; align-items:center; gap:.5rem;
      font-size:1.1rem; color:var(--gold); margin-bottom:.6rem;
    }
    .achievements-grid {
      display:grid; gap:.75rem;
      grid-template-columns:repeat(auto-fit,minmax(80px,1fr));
    }
    .achievement-badge {
      background:rgba(255,255,255,0.05); border-radius:8px;
      padding:.75rem; text-align:center;
      opacity:.4; transition:opacity .3s,box-shadow .3s;
    }
    .achievement-badge.unlocked {
      opacity:1; box-shadow:0 4px 12px rgba(255,152,0,0.4);
    }
    .achievement-badge i { font-size:1.4rem; color:var(--gold); margin-bottom:.3rem; }
    .achievement-badge p { font-size:.8rem; margin:0; }

   /*‚Äî COMMUNITY FEED SPECIFIC ‚Äî*/
    .post-box {
      background: var(--accent);
      padding: 1rem;
      border-radius: 8px;
      display: flex;
      gap: .75rem;
      margin-bottom: 1.5rem;
    }
    .post-box input {
      flex: 1;
      padding: .6rem;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.05);
      color: var(--white);
    }
    .post-box button {
      background: var(--gold);
      border: none;
      color: var(--bg);
      padding: .6rem 1.2rem;
      border-radius: 20px;
      cursor: pointer;
    }

    .feed-list { list-style:none; padding:0; }
    .feed-item {
      background: var(--accent);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      position: relative;
    }
    .feed-header {
      display: flex; align-items:center; gap:.75rem;
    }
    .feed-avatar {
      width: 36px; height:36px;
      border-radius:50%;
      object-fit:cover;
      background:#555;
    }
    .feed-meta .user { color:var(--gold); font-weight:600; }
    .feed-meta .time { font-size:.8rem; color:var(--white); opacity:.6; }
    .feed-text { margin: .75rem 0; line-height:1.4; }
    .feed-controls {
      display: flex; gap:1.2rem;
      border-top:1px solid rgba(255,255,255,0.1);
      padding-top:.75rem;
    }
    .feed-controls button {
      background:none; border:none; color:var(--white);
       cursor:pointer; display:flex; align-items:center; gap:.4rem;
  padding: 0.4rem 0.6rem;       
  border-radius:6px;
      transition:color .2s;
    }
    .feed-controls button:hover { color:var(--gold); }
    .comments-container {
      max-height:0; overflow:hidden;
      transition:max-height .3s ease;
      margin-top:.75rem; border-top:1px solid rgba(255,255,255,0.1);
      padding-top:.75rem;
    }
    .comments-container.open { max-height:600px; }
    .comment-item {
      display:flex; align-items:flex-start; gap:.6rem; margin-bottom:.6rem;
    }
    .comment-avatar {
      width:28px; height:28px; border-radius:50%; object-fit:cover; background:#777;
    }
    .comment-content {
      background: rgba(255,255,255,0.05);
      padding:.5rem .75rem;
      border-radius:6px;
      flex:1;
    }
    .comment-content .author { color:var(--gold); font-weight:600; margin-bottom:.2rem; }
    .comment-content .text  { line-height:1.3; }

    /* Chatbot */
    .chatbot { display: none !important; }
    .chatbot.active { display: flex !important; }

    /* ‚îÄ‚îÄ‚îÄ Stylized add-comment box ‚îÄ‚îÄ‚îÄ */
 .add-comment {
   background: var(--accent);
   padding: 0.6rem;
   border-radius: 12px;
   display: flex;
   align-items: center;
   gap: 0.5rem;
 }
 .add-comment .new-comment-input {
   flex: 1;
   padding: 0.6rem;
   border: none;
   border-radius: 20px;
   background: rgba(255,255,255,0.1);
   color: var(--white);
 }
 .add-comment .new-comment-btn {
   padding: 0.5rem 1rem;
   border-radius: 20px;
   background: var(--gold);
   color: var(--bg);
   font-weight: 600;
   cursor: pointer;
 }
 /* ‚îÄ‚îÄ‚îÄ Like button active state ‚îÄ‚îÄ‚îÄ */
 .like-btn .fa-heart.active,
 .c-like-btn .fa-heart.active {
   color: var(--gold);
 }
 .like-btn .fa-heart,
 .c-like-btn .fa-heart {
   color: var(--white);
 }

      

  .tag-btn {
    background: var(--accent);
    border: 1px solid var(--gold);
    color: var(--white);
    padding: .4rem .8rem;
    border-radius: 6px;
    cursor: pointer;
    transition: background .3s, color .3s;
  }
  .tag-btn.active,
  .tag-btn:hover {
    background: var(--gold);
    color: var(--bg);
  }

    /* New Workout Modal */
    .modal-overlay {
      display:none; position:fixed; inset:0;
      background:rgba(0,0,0,0.7); align-items:center; justify-content:center;
      z-index:var(--z-overlay);
    }
    .modal-overlay.active { display:flex; }
    .modal {
      background:var(--bg); border:2px solid var(--gold);
      border-radius:8px; padding:1.5rem; max-width:360px; width:90%;
      color:var(--white); max-height: 90vh;
    overflow-y: auto;
    }
    .modal h2 {
      color:var(--gold); margin-bottom:1rem; font-size:1.2rem;
    }
    .modal label {
      display:block; margin:.6rem 0 .2rem; font-size:.9rem;
    }
    .modal input, .modal select, .modal textarea {
      width:100%; padding:.6rem; border-radius:6px;
      border:1px solid rgba(255,255,255,0.3);
      background:rgba(255,255,255,0.05); color:var(--white);
      margin-bottom:.8rem;
      font-size:.9rem;
    }
    .modal button {
      width:100%; padding:.6rem; border:none; border-radius:6px;
      font-size:.95rem; cursor:pointer;
    }
    .modal button.primary { background:var(--gold); color:var(--bg); }
    .modal button.secondary { background:var(--dark-gray); color:var(--white); margin-top:.4rem; }
    /* Chatbot */
    #chatbot {
      position:fixed; bottom:20px; right:20px;
      width:320px; max-height:420px;
      background:#fff; color:#222;
      border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,0.15);
      display:none; flex-direction:column; overflow:hidden;
      font-family:'Poppins',sans-serif; border:1px solid #ddd;
      z-index:400;
    }
    #chatbot header {
      padding:.75rem 1rem; background:#f5f5f5;
      border-bottom:1px solid #e0e0e0;
      display:flex; align-items:center; justify-content:space-between;
      font-weight:600; font-size:1rem;
    }
    #chatbot .messages {
      flex:1; overflow-y:auto; background:#fff; padding:1rem;
    }
    #chatbot .msg {
      margin-bottom:.6rem; padding:.6rem .8rem;
      border-radius:12px; max-width:75%; line-height:1.3;
      word-break:break-word;
    }
    #chatbot .user { align-self:flex-end; background:#e8e8e8; color:#111; }
    #chatbot .bot  { align-self:flex-start; background:#f1f1f1; border:1px solid #ececec; }
    #chatbot .input {
      display:flex; border-top:1px solid #e0e0e0; padding:.5rem; gap:.5rem;
      background:#fafafa;
    }
    #chatbot .input select, #chatbot .input input {
      flex:1; font-size:.9rem;
      background:#fff; color:#222; border:1px solid #ccc; border-radius:8px;
      padding:.5rem;
    }
    #chatbot .input button {
      padding:.5rem .8rem; border:none; background:#222; color:#fff; border-radius:8px;
      cursor:pointer; transition:background .2s;
    }
    #chatbot .input button:hover { background:#000; }


#chatToggle {
  position: fixed;
  bottom: 20px; right: 20px;
  width: 50px; height: 50px;
  background: var(--white); color: var(--dark-gray);
  border: none; border-radius:50%;
  display: flex;                
  align-items: center; justify-content:center;
  font-size:1.4rem; cursor:pointer;
  z-index: 9999;
}


    /* Footer */
    footer {
      grid-column:1/-1; text-align:center; padding:1rem 0;
      border-top:1px solid rgba(255,255,255,0.2);
      font-size:.9rem; opacity:.7;
    }
  

  </style>

<body>
  <!-- Notification -->
  <div id="notif-bar" class="notif-bar hidden">
    üëã Complete your <a href="profile.html">profile</a> to unlock all features!
    <button id="notif-close">&times;</button>
  </div>

  <!-- Pseudo Workout Tip -->
  <div id="pseudo-toast" class="pseudo-toast">
    üèãÔ∏è‚Äç‚ôÄÔ∏è That workout was just a sample! Create your own under 
    <a href="workouts.html">Workouts</a>, 
    <a href="log.html">Log</a>, or click ‚ÄúNew Workout‚Äù. Check out 
    the <a href="leaderboard.html">Leaderboard</a> too!
  </div>

 
 <!-- Sidebar -->

  <div id="overlay" onclick="toggleSidebar()"></div>
  <aside class="sidebar" id="sidebar">
    <button id="sidebar-close" class="sidebar-close" aria-label="Close menu">&times;</button>
    <div class="logo"><i class="fas fa-heartbeat"></i></div>
    <a href="dashboard.html" class="menu-item active"><i class="fas fa-tachometer-alt"></i><span>Dash</span></a>
    <a href="log.html"       class="menu-item"><i class="fas fa-pen"></i><span>Log</span></a>
    <a href="workouts.html"  class="menu-item"><i class="fas fa-dumbbell"></i><span>Workouts</span></a>
    <a href="leaderboard.html" class="menu-item"><i class="fas fa-trophy"></i><span>Board</span></a>
     <a href="community.html" class="menu-item"><i class="fas fa-users"></i><span>Community</span></a>
    <button class="menu-item profile-menu" id="profileBtn">
      <i class="fas fa-user-circle avatar" id="side-avatar"></i><span>Profile</span>
    </button>
    <a href="signout.html" class="menu-item sign-out"><i class="fas fa-sign-out-alt"></i><span>Sign Out</span></a>
  </aside>


  <!-- Main content -->
  <div class="main">
    <header>
     <button id="hamburger" class="hamburger" onclick="toggleSidebar()">
<i class="fas fa-bars"></i></button>
      <h1 id="greeting">Loading‚Ä¶</h1>
      <button class="new-workout"><i class="fas fa-plus"></i><span>New Workout</span></button>
       <button id="profile-btn" class="profile-btn">
          <i class="fas fa-user-circle avatar" id="hdrAvatarIcon"></i>
          </button>
    </header>

    <div class="profile-summary">
      <img id="dash-avatar" class="avatar" src="" alt="Avatar"/>
      <span id="dash-name">‚Ä¶</span>
    </div>

    <div class="content">
      <!-- Stats -->
      <section class="stats">
        <div class="stat-card"><i class="fas fa-dumbbell"></i><h3 id="workoutsCount">0</h3><p>This Month</p></div>
        <div class="stat-card"><i class="fas fa-road"></i><h3 id="distanceCount">0‚ÄØkm</h3><p>Distance</p></div>
        <div class="stat-card"><i class="fas fa-fire"></i><h3 id="caloriesCount">0</h3><p>Calories</p></div>
        <div class="stat-card"><i class="fas fa-calendar-day"></i><h3 id="activeDaysCount">0</h3><p>Active Days</p></div>
        <div class="stat-card"><i class="fas fa-stopwatch"></i><h3 id="todayTime">0‚ÄØmin</h3><p>Today</p></div>
        <div class="stat-card"><i class="fas fa-percentage"></i><h3 id="avgCalories">0</h3><p>Avg Cal</p></div>
      </section>

      <!-- Weekly Goal -->
      <section class="progress">
        <h3><i class="fas fa-chart-line"></i> Weekly Goal</h3>
        <div class="bar-container"><div class="bar-fill" id="progressBar"></div></div>
      </section>

      <!-- Goals -->
      <section class="goals">
        <div class="goal-card"><p>Daily: 30‚ÄØmin</p><div class="goal-container"><div class="goal-fill" id="goalDaily"></div></div></div>
        <div class="goal-card"><p>Weekly: 5 workouts</p><div class="goal-container"><div class="goal-fill" id="goalWeekly"></div></div></div>
        <div class="goal-card"><p>Monthly: 20 workouts</p><div class="goal-container"><div class="goal-fill" id="goalMonthly"></div></div></div>
      </section>

      <!-- Charts -->
      <section class="charts">
        <div class="chart-card"><h3><i class="fas fa-chart-line"></i> Activity Over Time</h3><canvas id="activityChart"></canvas></div>
        <div class="chart-card"><h3><i class="fas fa-chart-pie"></i> Workout Distribution</h3><canvas id="distributionChart"></canvas></div>
      </section>

      <!-- Recent Activities -->
      <section class="quick-log">
        <h2><i class="fas fa-history"></i> Recent Activities</h2>
        <table><thead><tr><th>Date</th><th>Type</th><th>Duration</th><th>Km</th><th>Calories</th>      
        <th>Notes</th></tr></thead><tbody id="recent-acts"></tbody></table>
        <div class="fast-stats">
          <div><strong id="avg-dur">0</strong>‚ÄØmin avg</div>
          <div><strong id="tot-dist">0</strong>‚ÄØkm</div>
          <div><strong id="tot-cal">0</strong>‚ÄØcal</div>
        </div>
      </section>

      <!-- Tip of the Day -->
      <section class="daily-tip">
        <h2><i class="fas fa-lightbulb"></i> Tip of the Day</h2>
        <p id="tip-of-day"></p>
      </section>

      <!-- Upcoming Live Sessions -->
      <section class="live-sessions">
        <h2><i class="fas fa-video"></i> Upcoming Live Sessions</h2>
        <div class="live-grid" id="liveSessionsGrid"></div>
      </section>

      <!-- Top 5 Leaderboard -->
      <section class="mini-board">
        <h2><i class="fas fa-star"></i> Top‚ÄØ5</h2>
        <ol id="miniLeaderboard"></ol>
      </section>
     <div class="mini-board view-more-board">
      <a href="leaderboard.html">View full leaderboard ‚Üí</a>
    </div>
      <!-- Achievements -->
      <section class="top-achievements">
        <h2><i class="fas fa-medal"></i> Achievements</h2>
        <div class="achievements-grid" id="yourAchievements"></div>
      </section>

    <!-- Community Feed  -->
      <section class="community">
        <h2><i class="fas fa-users"></i> Community Feed</h2>
        <div class="post-box">
          <input id="newFeedInput" placeholder="Share something‚Ä¶"/>
          <button id="postFeedBtn"><i class="fas fa-paper-plane"></i> Post</button>
        </div>
        <div id="trending-topics" class="trending" style="margin:1rem 0;">
          <!-- same trending buttons as community.html -->
          <button class="tag-btn active" data-tag="All">All</button>
          <button class="tag-btn" data-tag="#HIIT">#HIIT</button>
          <button class="tag-btn" data-tag="#Yoga">#Yoga</button>
          <button class="tag-btn" data-tag="#Nutrition">#Nutrition</button>
          <button class="tag-btn" data-tag="#Running">#Running</button>
          <button class="tag-btn" data-tag="#Strength">#Strength</button>
        </div>
        <ul class="feed-list" id="communityFeed"></ul>
        <div class="view-more-posts" style="text-align:center;margin-top:1rem;">
          <a href="community.html">View more posts ‚Üí</a>
        </div>
      </section>
      <footer>&copy; 2025 FitTrack. All rights reserved.</footer>
    </div>
  </div>

  <!-- New Workout Modal -->
  <div id="workout-modal" class="modal-overlay">
    <div class="modal">
      <h2>Log New Workout</h2>
      <label for="w-date">Date</label>
      <input type="date" id="w-date"/>
      <label for="w-type">Type</label>
      <select id="w-type">
        <option>Cardio</option><option>Strength</option><option>Flexibility</option><option>Other</option>
      </select>
      <label for="w-duration">Duration (mins)</label>
      <input type="number" id="w-duration" placeholder="30"/>
      <label for="w-distance">Distance (km)</label>
      <input type="number" id="w-distance" placeholder="optional" step="0.1"/>
      <label for="w-calories">Calories</label>
      <input type="number" id="w-calories" placeholder="optional"/>
      <label for="w-notes">Notes</label>
      <textarea id="w-notes" rows="3" placeholder="How did it feel?"></textarea>
      <button class="primary" id="w-save">Save Workout</button>
      <button class="secondary" id="w-cancel">Cancel</button>
    </div>
  </div>
<!-- Dashboard Chatbot -->
<div id="chatbot" class="chatbot">
  <header><i class="fas fa-comments"></i> Dash Bot
    <button id="chatClose">&times;</button>
  </header>
  <div class="messages" id="chatMessages">
    <div class="msg bot">Hi! Ask me about your dashboard‚Ä¶</div>
  </div>
  <div class="input">
    <select id="questionSelect"><option disabled selected>Pick a question‚Ä¶</option></select>
    <input type="text" id="chatInput" placeholder="Or type your own‚Ä¶"/>
    <button type="button" id="askBtn"><i class="fas fa-paper-plane"></i></button>
</div>
<button id="chatToggle"><i class="fas fa-comments"></i></button>
  

 <script type="module">
import { Storage } from './storage.js';
import Chart from 'chart.js/auto';

document.addEventListener('DOMContentLoaded', () => {
  // ‚îÄ‚îÄ‚îÄ HELPERS & STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function getCurrent() {
    const c = Storage.get('ft_current') || {};
    return {
      name: c.name || '',
      avatarUrl: c.avatarDataUrl || '',
      profileComplete: !!c.profileComplete,
      isNew: c.isNew
    };
  }
  function timeAgo(ts) {
    const diff = Date.now() - ts;
    const m = Math.floor(diff / 60000);
    if (m < 1) return 'just now';
    if (m < 60) return `${m}m ago`;
    const h = Math.floor(m/60);
    if (h < 24) return `${h}h ago`;
    return `${Math.floor(h/24)}d ago`;
  }

  // ‚îÄ‚îÄ AUTH GUARD & CURRENT USER ‚îÄ‚îÄ
  const cur = getCurrent();
  if (!cur.name) return location.replace('home.html');
  const { name: me, avatarUrl: myAvatar } = cur;

  // ‚îÄ‚îÄ DOM REFS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const notifBar      = document.getElementById('notif-bar');
  const notifClose    = document.getElementById('notif-close');
  const pseudoToast   = document.getElementById('pseudo-toast');
  const hamburger     = document.getElementById('hamburger');
  const sidebar       = document.getElementById('sidebar');
  const overlay       = document.getElementById('overlay');
  const sidebarClose  = document.getElementById('sidebar-close');
  const profileBtn    = document.getElementById('profile-btn');
  const profileMenu   = document.querySelector('.profile-menu');
  const newWorkoutBtn = document.querySelector('.new-workout');
  const workoutModal  = document.getElementById('workout-modal');
  const wCancel       = document.getElementById('w-cancel');
  const wSave         = document.getElementById('w-save');
  const greetingEl    = document.getElementById('greeting');
  const activityCtx   = document.getElementById('activityChart').getContext('2d');
  const distributionCtx = document.getElementById('distributionChart').getContext('2d');
  const recentBody    = document.getElementById('recent-acts');
  const miniList      = document.getElementById('miniLeaderboard');
  const achGrid       = document.getElementById('yourAchievements');
  const liveGrid      = document.getElementById('liveSessionsGrid');
  const postInput     = document.getElementById('newFeedInput');
  const postBtn       = document.getElementById('postFeedBtn');
  const tipEl         = document.getElementById('tip-of-day');
  const communityFeed = document.getElementById('communityFeed');
  const tagButtons    = Array.from(document.querySelectorAll('.tag-btn'));
  let   currentTag    = 'All';  // ‚Üê initial filter

  // ‚îÄ‚îÄ NOTIFICATION BAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function syncNotif() {
    notifBar.classList.toggle('hidden', cur.profileComplete);
  }
  Storage.onChange('ft_current', syncNotif);
  syncNotif();
  notifClose.addEventListener('click', () => notifBar.classList.add('hidden'));

  // ‚îÄ‚îÄ SIDEBAR TOGGLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function toggleSidebar() {
    sidebar.classList.toggle('open');
    overlay.classList.toggle('active');
  }
  hamburger.addEventListener('click', toggleSidebar);
  sidebarClose.addEventListener('click', toggleSidebar);
  overlay.addEventListener('click', toggleSidebar);
  window.toggleSidebar = toggleSidebar;

  // ‚îÄ‚îÄ PROFILE NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  profileBtn.addEventListener('click', () => location.replace('profile.html'));
  profileMenu.addEventListener('click', () => location.replace('profile.html'));

  // ‚îÄ‚îÄ WELCOME NEW USER & PSEUDO-TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if (cur.isNew) {
    greetingEl.textContent = `Hello, ${me}!`;
    setTimeout(() => pseudoToast.classList.add('active'), 5000);
    cur.isNew = false;
    Storage.set('ft_current', { ...Storage.get('ft_current'), isNew: false });
    // announce in community feed
    const feed0 = Storage.get('ft_feed') || [];
    feed0.unshift({ user: me, avatarUrl: myAvatar, text: `${me} joined the community!`, timestamp: Date.now(), likes: 0, likedBy: [] });
    Storage.set('ft_feed', feed0);
  } else {
    greetingEl.textContent = `Welcome back, ${me}!`;
  }
  pseudoToast.addEventListener('click', () => pseudoToast.classList.remove('active'));

  // ‚îÄ‚îÄ WORKOUT MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  newWorkoutBtn.onclick = () => workoutModal.classList.add('active');
  wCancel.onclick       = () => workoutModal.classList.remove('active');
  wSave.onclick = () => {
    const date     = document.getElementById('w-date').value;
    const type     = document.getElementById('w-type').value;
    const duration = +document.getElementById('w-duration').value;
    if (!date || !duration) return alert('Date & duration required');
    const distance = +document.getElementById('w-distance').value;
    const calories = +document.getElementById('w-calories').value;
    const notes    = document.getElementById('w-notes').value.trim();
    const all      = Storage.get('ft_activities', []) || [];
    all.unshift({ id: Date.now().toString(), date, type, duration, distance, calories, notes });
    Storage.set('ft_activities', all);
    workoutModal.classList.remove('active');
    updateDashboard();
  };

  // ‚îÄ‚îÄ CHARTS SETUP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const activityChart = new Chart(activityCtx, {
    type: 'line',
    data: { labels: [], datasets: [{ data: [], borderColor: 'rgba(255,152,0,1)', backgroundColor: 'rgba(255,152,0,0.3)', fill:true, tension:0.3 }] },
    options: { responsive:true, maintainAspectRatio:false }
  });
  const distributionChart = new Chart(distributionCtx, {
    type: 'pie',
    data: {
      labels: ['Cardio','Strength','Flexibility','Other'],
      datasets: [{ data:[0,0,0,0], backgroundColor:['#ff9800','#2196f3','#4caf50','#e91e63'], hoverOffset:8, borderWidth:2 }]
    },
    options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'bottom' } } }
  });

  // ‚îÄ‚îÄ PROFILE AVATAR SYNC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function syncAvatars() {
    const p = getCurrent();
    ['dash-avatar','side-avatar','hdrAvatarIcon'].forEach(id => {
      const old = document.getElementById(id);
      if (!old) return;
      if (p.avatarUrl) {
        const img = document.createElement('img');
        img.id = id; img.className = 'avatar'; img.src = p.avatarUrl; img.alt = 'Avatar';
        old.replaceWith(img);
      } else {
        const icon = document.createElement('i');
        icon.id = id; icon.className = 'fas fa-user-circle avatar';
        old.replaceWith(icon);
      }
    });
    document.getElementById('dash-name').textContent = p.name;
  }
  syncAvatars();
  Storage.onChange('ft_current', syncAvatars);

  // ‚îÄ‚îÄ SEED DEMO COMMUNITY DATA ONCE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if (!Storage.get('ft_feed')) {
    const users  = ['Alice','Bob','Cara','Dan','Eve'];
    const texts  = ['5km run!','#HIIT session!','Hit PR deadlift!','#Yoga stretch','New smoothie recipe'];
    const feed   = texts.map((t,i) => ({ user:users[i], avatarUrl:'', text:t, timestamp:Date.now()-i*600000, likes:Math.floor(Math.random()*20), likedBy:[] }));
    const cmnts  = feed.map(_ => [{ user:'Friend', text:'Nice!', timestamp:Date.now(), likes:2, likedBy:[] }]);
    Storage.set('ft_feed', feed);
    Storage.set('ft_comments', cmnts);
  }

 
  // ‚îÄ‚îÄ Main render function ‚îÄ‚îÄ
  function updateDashboard(){
    const acts = Storage.get('ft_activities', []);
    const now  = new Date();

  // ‚Äî Monthly stats
    const monthActs = acts.filter(a => {
      const d = new Date(a.date);
      return d.getFullYear() === now.getFullYear() && d.getMonth() === now.getMonth();
    });
    document.getElementById('workoutsCount').textContent   = monthActs.length;
    const totDist = monthActs.reduce((s,a)=>s+(+a.distance||0),0).toFixed(1);
    document.getElementById('distanceCount').textContent   = `${totDist} km`;
    const totCal = monthActs.reduce((s,a)=>s+(+a.calories||0),0);
    document.getElementById('caloriesCount').textContent   = totCal;
    const activeDays = new Set(monthActs.map(a=>a.date)).size;
    document.getElementById('activeDaysCount').textContent = activeDays;

    // ‚Äî Today & Avg
    const todayKey = now.toISOString().slice(0,10);
    const todayMin = acts.filter(a=>a.date===todayKey).reduce((s,a)=>s+(+a.duration||0),0);
    document.getElementById('todayTime').textContent      = `${todayMin} min`;
    const avgCal = monthActs.length ? Math.round(totCal/monthActs.length) : 0;
    document.getElementById('avgCalories').textContent    = avgCal;

    // ‚Äî Goals bars
    const weekCount = acts.filter(a => (now - new Date(a.date)) / (1000*60*60*24) <= 7).length;
    document.getElementById('progressBar').style.width   = `${Math.min(100,Math.round(weekCount/5*100))}%`;
    document.getElementById('goalDaily').style.width     = `${Math.min(100,Math.round(todayMin/30*100))}%`;
    document.getElementById('goalWeekly').style.width    = `${Math.min(100,Math.round(weekCount/5*100))}%`;
    document.getElementById('goalMonthly').style.width   = `${Math.min(100,Math.round(monthActs.length/20*100))}%`;

    // ‚Äî Activity over time
    const labels = [], data7 = [];
    for (let i = 6; i >= 0; i--) {
      const d = new Date(); d.setDate(d.getDate() - i);
      labels.push(d.toLocaleDateString(undefined,{weekday:'short'}));
      data7.push(acts.filter(a=>a.date===d.toISOString().slice(0,10))
                     .reduce((s,a)=>s+(+a.duration||0),0));
    }
    activityChart.data.labels            = labels;
    activityChart.data.datasets[0].data  = data7;
    activityChart.update();

  // ‚Äî Distribution pie (dynamic)
  // 1) Count each workout type in this month
  const countsByType = monthActs.reduce((acc, a) => {
    acc[a.type] = (acc[a.type] || 0) + 1;
    return acc;
  }, {});
  // 2) Build labels & data arrays
  const types  = Object.keys(countsByType);
  const counts = types.map(t => countsByType[t]);
  // 3) Feed into Chart.js
  distributionChart.data.labels           = types;
  distributionChart.data.datasets[0].data = counts;
  distributionChart.update();

   // ‚Äî Summary stats for Recent Activities (min avg / km / cal)
  const recent = acts.slice(0,7);
  let sumDur=0, sumDist=0, sumCal=0;
  recent.forEach(a => {
    sumDur  += (+a.duration  || 0);
    sumDist += (+a.distance  || 0);
    sumCal  += (+a.calories  || 0);
  });
  document.getElementById('avg-dur').textContent  = recent.length ? Math.round(sumDur/recent.length) : 0;
  document.getElementById('tot-dist').textContent = sumDist.toFixed(1);
  document.getElementById('tot-cal').textContent  = sumCal;
    recentBody.innerHTML = '';
    acts.slice(0,7).forEach(e => {
      recentBody.insertAdjacentHTML('beforeend', `
        <tr>
          <td>${e.date}</td>
          <td>${e.type}</td>
          <td>${e.duration}</td>
          <td>${e.distance||'‚Äì'}</td>
          <td>${e.calories||'‚Äì'}</td>
          <td>${e.notes||'‚Äì'}</td>
        </tr>`);
    });


    // ‚Äî Top-5 leaderboard (names + scores only)
    const rawLB = Storage.get('ft_leaderboard', []).map(u=>({
      ...u, score: (u.workouts||0)*10 + Math.round((u.distanceKm||0)*2)
    }));
    const top5 = rawLB.sort((a,b)=>b.score-a.score).slice(0,5);
    miniList.innerHTML = '';
    top5.forEach(u => {
      miniList.insertAdjacentHTML('beforeend', `
        <li style="display:flex;justify-content:space-between;">
          <span>${u.name}</span><strong>${u.score}</strong>
        </li>`);
    });

    // ‚Äî Achievements badges
    const total = acts.length;
    const badges = [
      {n:1, icon:'fas fa-star',   txt:'First Workout'},
      {n:5, icon:'fas fa-medal',  txt:'5 Workouts'},
      {n:10,icon:'fas fa-trophy', txt:'10 Workouts'},
      {n:30,icon:'fas fa-award',  txt:'30 Workouts'}
    ];
    achGrid.innerHTML = '';
    badges.forEach(b => {
      achGrid.insertAdjacentHTML('beforeend', `
        <div class="achievement-badge${total>=b.n?' unlocked':''}">
          <i class="${b.icon}"></i><p>${b.txt}</p>
        </div>`);
    });

   // ‚Äî‚Äî Upcoming Live Sessions
    liveGrid.innerHTML = '';
    const sessions = Storage.get('ft_liveSessions', []);
    const schedIds  = Storage.get('ft_mySchedules', []);
    sessions.forEach(s => {
      const start    = new Date(s.date||s.start);
      const isFuture = start > new Date();
      const joined   = schedIds.includes(s.id);
      const btnTxt   = isFuture
                       ? (joined ? '‚úî Scheduled' : '‚è± Schedule')
                       : 'üî¥ LIVE';
      liveGrid.insertAdjacentHTML('beforeend', `
        <div class="live-card">
          <img src="${s.img}" alt="${s.title}"/>
          <span class="session-date">${start.toLocaleString(undefined,{
            month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'
          })}</span>
          <h3>${s.title}</h3>
          <p class="host-name">${s.host}</p>
          <button data-id="${s.id}" class="live-btn">${btnTxt}</button>
        </div>`);
    });
    document.querySelectorAll('.live-btn').forEach(btn => {
      btn.onclick = e => {
        const id = +e.currentTarget.dataset.id;
        let arr = Storage.get('ft_mySchedules', []);
        if (e.currentTarget.textContent.includes('Schedule')) {
          if (!arr.includes(id)) arr.push(id);
          alert('Session scheduled!');
        } else {
          alert('Enjoy the live session!');
        }
        Storage.set('ft_mySchedules', arr);
        updateDashboard();
      };
    });
// ‚Äî‚Äî Delegate live-session clicks (schedule / join)
  liveGrid.addEventListener('click', e => {
    const btn = e.target.closest('button.live-btn');
    if (!btn) return;
    const id = +btn.dataset.id;
    let sched = Storage.get('ft_mySchedules', []);
    if (btn.textContent.includes('Schedule')) {
      if (!sched.includes(id)) sched.push(id);
      btn.textContent = '‚úî Scheduled';
    } else if (btn.textContent.includes('LIVE')) {
      alert('Joining live session‚Ä¶');
    }
    Storage.set('ft_mySchedules', sched);
    updateDashboard();
    renderCommunity();
  });
  // ‚Äî LOAD OR SEED DATA ‚Äî
    let feed  = Storage.get('ft_feed')     || [];
    let cmnts = Storage.get('ft_comments') || [];


  // ‚îÄ‚îÄ COMMUNITY FEED RENDER (TOP 5 + FILTER) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderCommunity() {
    const feed = Storage.get('ft_feed') || [];
    const cmnts = Storage.get('ft_comments') || [];
    communityFeed.innerHTML = '';
    feed.slice(0,5).forEach((post,i) => {
      if (currentTag !== 'All' && !post.text.includes(currentTag)) return;
      // choose avatar
      const avatarHtml = post.user === me
        ? (myAvatar ? `<img class="feed-avatar" src="${myAvatar}"/>` : `<i class="fas fa-user-circle feed-avatar avatar"></i>`)
        : (post.avatarUrl ? `<img class="feed-avatar" src="${post.avatarUrl}"/>` : `<i class="fas fa-user-circle feed-avatar avatar"></i>`);
      const commentsHtml = (cmnts[i]||[]).map(c => `
        <div class="comment-item">
          ${c.user===me && myAvatar
            ? `<img class="comment-avatar" src="${myAvatar}"/>`
            : (c.avatarUrl ? `<img class="comment-avatar" src="${c.avatarUrl}"/>` : `<i class="fas fa-user-circle comment-avatar avatar"></i>`)}
          <div class="comment-content">
            <span class="author">${c.user}</span>
            <span class="time">${timeAgo(c.timestamp)}</span>
            <p class="text">${c.text}</p>
          </div>
        </div>
      `).join('');
      communityFeed.insertAdjacentHTML('beforeend', `
        <li class="feed-item">
          <div class="feed-header">
            ${avatarHtml}
            <div class="feed-meta">
              <span class="user">${post.user}</span>
              <span class="time">${timeAgo(post.timestamp)}</span>
            </div>
          </div>
          <p class="feed-text">${post.text}</p>
          <div class="feed-controls">
            <button class="toggle-comments">‚ñº ${ (cmnts[i]||[]).length } comments</button>
            <button class="like-btn"><i class="fas fa-heart${post.likedBy.includes(me)?' active':''}"></i> <span>${post.likes}</span></button>
          </div>
          <div class="comments-container">
            ${commentsHtml}
            <div class="add-comment">
              ${ myAvatar ? `<img class="comment-avatar" src="${myAvatar}"/>` : `<i class="fas fa-user-circle comment-avatar avatar"></i>` }
              <input class="new-comment-input" placeholder="Add a comment‚Ä¶"/>
              <button class="new-comment-btn">Post</button>
            </div>
          </div>
        </li>
      `);
    });
    renderCommunity();
  }

  // ‚îÄ‚îÄ EVENT BINDINGS FOR COMMUNITY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Post new feed item
  postBtn.addEventListener('click', () => {
    const txt = postInput.value.trim();
    if (!txt) return;
    const f = Storage.get('ft_feed') || [];
    const c = Storage.get('ft_comments') || [];
    f.unshift({ user:me, avatarUrl:myAvatar, text:txt, timestamp:Date.now(), likes:0, likedBy:[] });
    c.unshift([]);
    Storage.set('ft_feed', f);
    Storage.set('ft_comments', c);
    postInput.value = '';
    renderCommunity();
  });
  // Like / toggle / comment
  communityFeed.addEventListener('click', e => {
    const li = e.target.closest('.feed-item');
    if (!li) return;
    const idx = Array.from(communityFeed.children).indexOf(li);
    const f = Storage.get('ft_feed');
    const c = Storage.get('ft_comments');
    // like post
    if (e.target.closest('.like-btn')) {
      const p = f[idx];
      const pos = p.likedBy.indexOf(me);
      if (pos >= 0) { p.likedBy.splice(pos,1); p.likes--; }
      else          { p.likedBy.push(me); p.likes++; }
      Storage.set('ft_feed', f);
      renderCommunity();
      return;
    }
    // toggle comments
    if (e.target.closest('.toggle-comments')) {
      li.querySelector('.comments-container').classList.toggle('open');
      return;
    }
    // post inline comment
    if (e.target.closest('.new-comment-btn')) {
      const inp = li.querySelector('.new-comment-input');
      const txt = inp.value.trim();
      if (!txt) return;
      c[idx].push({ user:me, avatarUrl:myAvatar, text:txt, timestamp:Date.now(), likes:0, likedBy:[] });
      Storage.set('ft_comments', c);
      renderCommunity();
      return;
    }
  });

  // ‚îÄ‚îÄ TRENDING TAG BUTTONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  tagButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      tagButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentTag = btn.dataset.tag;
      renderCommunity();
    });
  });

  // ‚îÄ‚îÄ CHATBOT TOGGLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('chatToggle').addEventListener('click', () => {
    document.getElementById('chatbot').classList.add('active');
  });
  document.getElementById('chatClose').addEventListener('click', () => {
    document.getElementById('chatbot').classList.remove('active');
  });

  // ‚îÄ‚îÄ TIP OF THE DAY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const tips = [
    "Stay hydrated‚Äîdrink 250 ml before workouts.",
    "Warm up 5 min to activate muscles.",
    "Focus on form; quality reps build strength.",
    "Cool down & stretch after each session.",
    "Try a fun activity weekly to stay motivated."
  ];
  tipEl.textContent = tips[Math.floor(Math.random()*tips.length)];

  // ‚îÄ‚îÄ INITIALIZE EVERYTHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  updateDashboard();
renderCommunity();

Storage.onChange(
  ['ft_activities','ft_leaderboard','ft_mySchedules','ft_liveSessions','ft_feed','ft_comments'],
  () => {
    updateDashboard();
    renderCommunity();
  }
);

  });
</script>

</body>
</html>
