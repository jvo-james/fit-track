<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FitTrack | Dashboard</title>
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <script defer src="https://kit.fontawesome.com/a2e8f1b6b1.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #000;
      --gold: #ff9800;
      --white: #fff;
      --font-base: 'Raleway', sans-serif;
      --font-head: 'Poppins', sans-serif;
      --transition: .3s ease;
      --header-h: 60px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: var(--font-base);
      background: var(--bg);
      color: var(--white);
      display: flex;
      min-height: 100vh;
      overflow-x: hidden;
    }
    a { color:inherit; text-decoration:none; }
    button { 
      font-family: var(--font-head);
      transition: var(--transition);
      cursor: pointer;
      background: transparent; border: none; color: var(--white);
    }
    /* Sidebar */
    .sidebar {
      width:80px; background: rgba(0,0,0,0.9);
      border-right:2px solid var(--gold);
      display:flex; flex-direction:column; align-items:center;
      padding-top:1rem; position:sticky; top:0; height:100vh;
      z-index:100;
    }
    .sidebar a, .sidebar button {
      width:100%; padding:.8rem 0;
      text-align:center; color:var(--white);
    }
    .sidebar a:hover, .sidebar button:hover { background:rgba(255,152,0,0.2); }
    .sidebar .logo { font-size:1.6rem; color:var(--gold); margin-bottom:2rem; }
    /* Main area */
    .main {
      flex:1; display:flex; flex-direction:column;
    }
    header {
      height: var(--header-h);
      display:flex; align-items:center; justify-content:space-between;
      padding:0 1.5rem; background: rgba(0,0,0,0.9);
      border-bottom:2px solid var(--gold);
      position:sticky; top:0; z-index:200;
    }
    header h1 { font-size:1.4rem; flex:1; text-align:center; }
    .new-workout {
      background: var(--gold); color: var(--bg);
      padding:.5rem 1rem; border-radius:30px;
      display:flex; align-items:center; gap:.4rem;
    }
    /* Notification bar */
    .notif-bar {
      display:flex; align-items:center; justify-content:space-between;
      background:rgba(255,152,0,0.1); border-left:4px solid var(--gold);
      padding:.8rem 1.5rem; font-size:.95rem;
      position:sticky; top:var(--header-h); z-index:199;
    }
    .notif-bar.hidden { display:none; }
    .notif-bar button { font-size:1.2rem; }
    /* Content */
    .content { padding:1.5rem; overflow-y:auto; flex:1; }
    .stats {
      display:grid; gap:1rem;
      grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
    }
    .stat-card {
      background: rgba(255,255,255,0.05);
      padding:1rem; border-radius:8px; text-align:center;
      transition: var(--transition);
    }
    .stat-card:hover { background: rgba(255,255,255,0.1); }
    .stat-card i { font-size:1.4rem; color:var(--gold); margin-bottom:.4rem; }
    .stat-card h3 { font-size:1.2rem; }
    /* Weekly summary */
    .weekly-summary {
      background: rgba(255,255,255,0.05);
      padding:1rem; border-radius:8px; margin-top:1rem;
      display:flex; gap:1rem; justify-content:space-around;
      text-align:center;
    }
    /* Progress bars */
    .progress, .goals { margin-top:1.5rem; }
    .bar-container, .goal-container {
      background: rgba(255,255,255,0.2);
      height:10px; border-radius:6px; overflow:hidden;
    }
    .bar-fill, .goal-fill {
      height:100%; background: var(--gold);
      width:0; transition:width 1s ease;
    }
    .goals { display:grid; gap:1rem; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); }
    .goal-card { background:rgba(255,255,255,0.05); padding:.8rem; border-radius:8px; }
    /* Charts */
    .charts { margin-top:1.5rem; display:grid; gap:1rem;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
    }
    .chart-card { background:rgba(255,255,255,0.05); padding:1rem; border-radius:8px; }
    .chart-card canvas { width:100% !important; height:250px !important; }
    /* Quick log */
    .quick-log { margin-top:1.5rem; background:rgba(255,255,255,0.05);
      padding:1rem; border-radius:8px;
    }
    .quick-log table { width:100%; border-collapse:collapse; }
    .quick-log th, .quick-log td {
      padding:.5rem; border-bottom:1px solid rgba(255,255,255,0.2);
    }
    /* Tip */
    .daily-tip { margin-top:1.5rem; background:rgba(255,255,255,0.05);
      padding:1rem; border-radius:8px;
    }
    /* Live Sessions */
    .live-sessions { margin-top:1.5rem; }
    .live-grid {
      display:grid; gap:1rem;
      grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
    }
    .live-card { background:rgba(255,255,255,0.05); padding:.75rem;
      border-radius:8px; text-align:center;
    }
    .live-card img { width:100%; height:80px; object-fit:cover; border-radius:6px; }
    .live-card button { margin-top:.5rem; background:var(--gold); color:var(--bg);
      padding:.3rem .6rem; border-radius:4px;
    }
    /* Mini leaderboard */
    .mini-board { margin-top:1.5rem; }
    /* Achievements */
    .top-achievements { margin-top:1.5rem; }
    .achievements-grid {
      display:grid; gap:.75rem;
      grid-template-columns:repeat(auto-fit,minmax(80px,1fr));
    }
    .achievement-badge {
      background:rgba(255,255,255,0.05); padding:.75rem; border-radius:8px;
      text-align:center; opacity:.4; transition:.3s;
    }
    .achievement-badge.unlocked { opacity:1; box-shadow:0 4px 12px rgba(255,152,0,0.4); }
    /* Modal */
    .modal-overlay {
      position:fixed; inset:0; background:rgba(0,0,0,0.7);
      display:none; align-items:center; justify-content:center; z-index:300;
    }
    .modal-overlay.active { display:flex; }
    .modal { background:var(--bg); padding:1.5rem; border-radius:8px;
      width:90%; max-width:360px; position:relative;
    }
    .modal .close { position:absolute; top:.6rem; right:.6rem; font-size:1.2rem; }
    .modal label { display:block; margin:.6rem 0 .2rem; font-size:.9rem; }
    .modal input, .modal select, .modal textarea {
      width:100%; padding:.6rem; border-radius:6px;
      border:1px solid rgba(255,255,255,0.3);
      background:rgba(255,255,255,0.05); color:var(--white);
      font-family:var(--font-base); font-size:.9rem;
    }
    .modal textarea { resize: vertical; min-height:60px; }
    .modal button.primary {
      margin-top:.8rem; width:100%; padding:.6rem;
      background:var(--gold); color:var(--bg);
      border-radius:30px; font-weight:600;
    }
    /* Tour */
    #tour-overlay {
      display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7);
      z-index:500;
    }
    #tour-tooltip {
      display:none; position:absolute; background:#fff; color:#000;
      padding:1rem; border-radius:5px; max-width:240px; z-index:501;
    }
    @media(max-width:600px){
      .stats { grid-template-columns:1fr 1fr; }
      .charts { grid-template-columns:1fr; }
      .quick-log table, .weekly-summary { font-size:.85rem; }
    }
  </style>
</head>

<body>
  <aside class="sidebar">
    <div class="logo"><i class="fas fa-heartbeat"></i></div>
    <a href="dashboard.html" class="active"><i class="fas fa-tachometer-alt"></i></a>
    <a href="log.html"><i class="fas fa-pen"></i></a>
    <a href="workouts.html"><i class="fas fa-dumbbell"></i></a>
    <a href="board.html"><i class="fas fa-trophy"></i></a>
    <button class="profile-menu"><i class="fas fa-user-circle"></i></button>
    <a href="home.html"><i class="fas fa-sign-out-alt"></i></a>
  </aside>

  <div class="main">
    <header>
      <button id="hamburger"><i class="fas fa-bars"></i></button>
      <h1 id="greeting">‚Ä¶</h1>
      <button class="new-workout"><i class="fas fa-plus"></i> New Workout</button>
    </header>

    <div id="notif-bar" class="notif-bar hidden">
      üëã Please <a href="profile.html">complete your profile</a>.
      <button id="notif-close">&times;</button>
    </div>

    <div class="content">
      <!-- Profile summary -->
      <div class="weekly-summary">
        <div><img id="dash-avatar" class="avatar" src="" alt="You"><br><strong id="dash-name"></strong></div>
        <div>üèÜ Level: <strong id="user-level">‚Äî</strong></div>
        <div>üîî Notifications: <strong id="notif-count">0</strong></div>
      </div>

      <!-- Stats grid -->
      <section class="stats">
        <div class="stat-card"><i class="fas fa-dumbbell"></i><h3 id="workoutsCount">0</h3><p>This Month</p></div>
        <div class="stat-card"><i class="fas fa-road"></i><h3 id="distanceCount">0 km</h3><p>Distance</p></div>
        <div class="stat-card"><i class="fas fa-fire"></i><h3 id="caloriesCount">0</h3><p>Calories</p></div>
        <div class="stat-card"><i class="fas fa-calendar-day"></i><h3 id="activeDaysCount">0</h3><p>Days</p></div>
        <div class="stat-card"><i class="fas fa-stopwatch"></i><h3 id="todayTime">0 min</h3><p>Today</p></div>
        <div class="stat-card"><i class="fas fa-percentage"></i><h3 id="avgCalories">0</h3><p>Avg Cal</p></div>
      </section>

      <!-- Goals & progress -->
      <section class="progress">
        <h3><i class="fas fa-chart-line"></i> Weekly Goal</h3>
        <div class="bar-container"><div id="progressBar" class="bar-fill"></div></div>
      </section>
      <section class="goals">
        <div class="goal-card"><p>Daily: 30‚Äâmin</p><div class="goal-container"><div id="goalDaily" class="goal-fill"></div></div></div>
        <div class="goal-card"><p>Weekly: 5 workouts</p><div class="goal-container"><div id="goalWeekly" class="goal-fill"></div></div></div>
        <div class="goal-card"><p>Monthly: 20 workouts</p><div class="goal-container"><div id="goalMonthly" class="goal-fill"></div></div></div>
      </section>

      <!-- Charts -->
      <section class="charts">
        <div class="chart-card">
          <h3><i class="fas fa-chart-line"></i> Activity Over Time</h3>
          <canvas id="activityChart"></canvas>
        </div>
        <div class="chart-card">
          <h3><i class="fas fa-chart-pie"></i> Workout Distribution</h3>
          <canvas id="distributionChart"></canvas>
        </div>
      </section>

      <!-- Quick Log -->
      <div class="quick-log">
        <h2><i class="fas fa-history"></i> Recent Activities</h2>
        <table>
          <thead><tr><th>Date</th><th>Type</th><th>Dur.</th><th>Km</th></tr></thead>
          <tbody id="recent-acts"></tbody>
        </table>
      </div>

      <!-- Tip of the day -->
      <div class="daily-tip">
        <h2><i class="fas fa-lightbulb"></i> Tip of the Day</h2>
        <p id="tip-of-day"></p>
      </div>

      <!-- Live sessions -->
      <div class="live-sessions">
        <h2><i class="fas fa-video"></i> Upcoming Live Sessions</h2>
        <div id="liveSessionsGrid" class="live-grid"></div>
      </div>

      <!-- Mini Leaderboard -->
      <div class="mini-board">
        <h2><i class="fas fa-trophy"></i> Top 5 Leaderboard</h2>
        <ol id="miniLeaderboard"></ol>
      </div>

      <!-- Achievements -->
      <div class="top-achievements">
        <h2><i class="fas fa-medal"></i> Achievements</h2>
        <div id="yourAchievements" class="achievements-grid"></div>
      </div>
    </div>

    <footer>
      &copy; 2025 FitTrack. All rights reserved.
    </footer>
  </div>

  <!-- New Workout Modal -->
  <div id="workout-modal" class="modal-overlay">
    <div class="modal">
      <button class="close" id="workout-close">&times;</button>
      <h2>Log New Workout</h2>
      <label>Date</label>
      <input type="date" id="w-date">
      <label>Duration (mins)</label>
      <input type="number" id="w-duration" min="1">
      <label>Type</label>
      <select id="w-type">
        <option>Cardio</option>
        <option>Strength</option>
        <option>Flexibility</option>
        <option>Other</option>
      </select>
      <label>Distance (km)</label>
      <input type="number" id="w-distance" step="0.1">
      <label>Calories</label>
      <input type="number" id="w-calories" min="0">
      <label>Notes</label>
      <textarea id="w-notes" placeholder="Any extra details‚Ä¶"></textarea>
      <button class="primary" id="w-save">Save Workout</button>
    </div>
  </div>

  <!-- Tour overlay -->
  <div id="tour-overlay"></div>
  <div id="tour-tooltip"></div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // ‚îÄ‚îÄ‚îÄ 1) Redirect if not signed in ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const curJSON = localStorage.getItem('ft_current');
    if (!curJSON) { location.href='home.html'; return; }
    const cur = JSON.parse(curJSON);
    if (!cur.name) { location.href='home.html'; return; }

    // ‚îÄ‚îÄ‚îÄ 2) Greeting & incomplete‚Äëprofile banner ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const greet = document.getElementById('greeting'),
          banner= document.getElementById('notif-bar'),
          prof  = JSON.parse(localStorage.getItem('ft_profile')||'{}');
    greet.textContent = cur.isNew ? `Hello ${cur.name}!` : `Welcome back, ${cur.name}!`;
    if (!prof.name || !prof.avatar) banner.classList.remove('hidden');
    document.getElementById('notif-close')
            .onclick = () => banner.classList.add('hidden');

    // ‚îÄ‚îÄ‚îÄ 3) One‚Äëtime tour ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if (cur.isNew) {
      runTour([
        { sel: '.stats',         msg: 'See your monthly stats here.' },
        { sel: '.live-sessions', msg: 'Schedule or join live sessions.' },
        { sel: '.charts',        msg: 'Track your activity over time.' },
        { sel: '.mini-board',    msg: 'Check the top-5 leaderboard.' }
      ]);
      cur.isNew=false;
      localStorage.setItem('ft_current', JSON.stringify(cur));
    }

    // ‚îÄ‚îÄ‚îÄ 4) Sidebar toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const sidebar = document.querySelector('.sidebar'),
          overlay = document.getElementById('hamburger'),
          closeBtn= document.getElementById('sidebar-close'),
          ov= document.getElementById('overlay');
    // (we already have CSS-only behavior on mobile via the hamburger icon if desired)

    // ‚îÄ‚îÄ‚îÄ 5) Profile nav ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    document.querySelectorAll('.profile-menu, #profile-btn')
      .forEach(el=>el.onclick = ()=> location.href='profile.html');

    // ‚îÄ‚îÄ‚îÄ 6) New‚Äëworkout modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const modal= document.getElementById('workout-modal'),
          openM= document.querySelector('.new-workout'),
          closeM= document.getElementById('workout-close'),
          saveM = document.getElementById('w-save');
    openM.onclick  = ()=> modal.classList.add('active');
    closeM.onclick = ()=> modal.classList.remove('active');
    modal.onclick  = e=> { if(e.target===modal) modal.classList.remove('active'); };
    saveM.onclick  = ()=> {
      const date = document.getElementById('w-date').value,
            dur  = +document.getElementById('w-duration').value,
            type = document.getElementById('w-type').value,
            dist = +document.getElementById('w-distance').value||0,
            cal  = +document.getElementById('w-calories').value||0,
            notes= document.getElementById('w-notes').value;
      if (!date||dur<1) return alert('Enter date & duration');
      const all = JSON.parse(localStorage.getItem('ft_activities')||'[]');
      all.unshift({ id:Date.now(), date, duration:dur, type, distance:dist, calories:cal, notes });
      localStorage.setItem('ft_activities', JSON.stringify(all));
      updateDashboard();
      modal.classList.remove('active');
    };

    // ‚îÄ‚îÄ‚îÄ 7) Utility: One-time tour ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function runTour(steps) {
      let idx=0;
      const ov=document.getElementById('tour-overlay'),
            tt=document.getElementById('tour-tooltip');
      ov.style.display=tt.style.display='block';
      function show(){
        const {sel,msg}=steps[idx],
              el=document.querySelector(sel),
              r=el.getBoundingClientRect();
        tt.innerHTML = `<p>${msg}</p>
                        <button>${idx===steps.length-1?'Done':'Next'}</button>`;
        tt.style.top  = (r.bottom+8)+'px';
        tt.style.left = r.left+'px';
        tt.querySelector('button').onclick = ()=>{
          idx++;
          if (idx<steps.length) show();
          else ov.style.display=tt.style.display='none';
        };
      }
      show();
    }

    // ‚îÄ‚îÄ‚îÄ 8) Update functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function updateProfileSummary(){
      const p=JSON.parse(localStorage.getItem('ft_profile')||'{}');
      document.getElementById('dash-name').textContent = cur.name;
      document.getElementById('dash-avatar').src =
        p.avatar || `https://i.pravatar.cc/150?u=${cur.email}`;
    }

    function updateStats(){
      const acts = JSON.parse(localStorage.getItem('ft_activities')||'[]'),
            now  = new Date(), todayKey=now.toISOString().slice(0,10);
      // monthly
      const month = acts.filter(a=>{
        const d=new Date(a.date);
        return d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear();
      });
      document.getElementById('workoutsCount').textContent = month.length;
      const dist = month.reduce((s,a)=>s+(a.distance||0),0).toFixed(1)+' km';
      document.getElementById('distanceCount').textContent=dist;
      document.getElementById('caloriesCount').textContent=
        month.reduce((s,a)=>s+(a.calories||0),0);
      document.getElementById('activeDaysCount').textContent=
        new Set(month.map(a=>a.date)).size;
      // today
      const todayTotal = acts.filter(a=>a.date===todayKey)
                             .reduce((s,a)=>s+(a.duration||0),0);
      document.getElementById('todayTime').textContent = todayTotal+' min';
      document.getElementById('avgCalories').textContent =
        month.length ? Math.round(
          month.reduce((s,a)=>s+(a.calories||0),0)/month.length
        ) : 0;
      // progress bars
      const weekCount = acts.filter(a=>{
        const d=new Date(a.date);
        return (now-d)/(1000*60*60*24)<=7;
      }).length;
      document.getElementById('progressBar').style.width = Math.min(100,Math.round(weekCount/5*100))+'%';
      document.getElementById('goalDaily').style.width    = Math.min(100,Math.round(todayTotal/30*100))+'%';
      document.getElementById('goalWeekly').style.width   = Math.min(100,Math.round(weekCount/5*100))+'%';
      document.getElementById('goalMonthly').style.width  = Math.min(100,Math.round(month.length/20*100))+'%';
    }

    // charts
    const actCtx = document.getElementById('activityChart').getContext('2d'),
          distCtx= document.getElementById('distributionChart').getContext('2d');
    const activityChart = new Chart(actCtx,{
      type:'line',
      data:{labels:[],datasets:[{
        label:'Minutes',data:[],
        borderColor:'#ff9800',
        backgroundColor:'rgba(255,152,0,0.2)',
        fill:true,tension:.3
      }]},
      options:{responsive:true,maintainAspectRatio:false,
        plugins:{ legend:{position:'bottom'} }}
    });
    const distributionChart = new Chart(distCtx,{
      type:'pie',
      data:{labels:['Cardio','Strength','Flexibility','Other'],datasets:[{
        data:[],backgroundColor:[
          'rgba(255,152,0,0.8)','rgba(255,87,34,0.8)',
          'rgba(76,175,80,0.8)','rgba(3,169,244,0.8)'
        ]
      }]},
      options:{responsive:true,maintainAspectRatio:false,
        plugins:{ legend:{position:'bottom'} }}
    });
    function updateCharts(){
      const acts=JSON.parse(localStorage.getItem('ft_activities')||'[]'),
            labels=[], data=[];
      for(let d=6;d>=0;d--){
        const day=new Date(); day.setDate(day.getDate()-d);
        const key=day.toISOString().slice(0,10);
        labels.push(day.toLocaleDateString(undefined,{weekday:'short'}));
        data.push(acts.filter(a=>a.date===key)
                      .reduce((s,a)=>s+(a.duration||0),0));
      }
      activityChart.data.labels=labels;
      activityChart.data.datasets[0].data=data;
      activityChart.update();
      // distribution
      const distCounts={Cardio:0,Strength:0,Flexibility:0,Other:0};
      acts.forEach(a=>{
        distCounts[a.type] = (distCounts[a.type]||0)+1;
      });
      distributionChart.data.datasets[0].data = [
        distCounts.Cardio,distCounts.Strength,
        distCounts.Flexibility,distCounts.Other
      ];
      distributionChart.update();
    }

    function updateRecent(){
      const acts=JSON.parse(localStorage.getItem('ft_activities')||'[]').slice(0,5),
            tbody=document.getElementById('recent-acts');
      tbody.innerHTML='';
      acts.forEach(a=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${a.date}</td>
                      <td>${a.type}</td>
                      <td>${a.duration}</td>
                      <td>${a.distance||'‚Äì'}</td>`;
        tbody.appendChild(tr);
      });
    }

    function updateTip(){
      const tips=[
        "Stay hydrated‚Äîdrink 250‚ÄØml before each session.",
        "Warm‚Äëup 5‚ÄØmin to activate muscles.",
        "Focus on form; quality reps are safer.",
        "Cool down & stretch for 3‚Äì5‚ÄØmin after.",
        "Try one fun activity each week."
      ];
      document.getElementById('tip-of-day').textContent =
        tips[Math.floor(Math.random()*tips.length)];
    }

    function updateLive(){
      const sess=JSON.parse(localStorage.getItem('ft_liveSessions')||'[]'),
            sched=JSON.parse(localStorage.getItem('ft_mySchedules')||'[]'),
            grid=document.getElementById('liveSessionsGrid');
      grid.innerHTML='';
      sess.sort((a,b)=>new Date(a.start)-new Date(b.start))
          .forEach(s=>{
        const st=new Date(s.start),
              now=new Date(),
              future=st>now,
              txt= future
                ? (sched.includes(s.id)?'‚úî Scheduled':'Schedule')
                : 'Join Now',
              cls= future?'schedule-btn':'join-btn';
        grid.insertAdjacentHTML('beforeend',`
          <div class="live-card">
            <img src="${s.img}" alt="">
            <h3>${s.title}</h3>
            <p>${s.host} ‚Ä¢ ${st.toLocaleString()}</p>
            <button data-id="${s.id}" class="${cls}">${txt}</button>
          </div>`);
      });
    }
    document.getElementById('liveSessionsGrid')
      .onclick = e=>{
        const btn=e.target;
        if(btn.classList.contains('schedule-btn')){
          const id=btn.dataset.id,
                arr=JSON.parse(localStorage.getItem('ft_mySchedules')||'[]');
          if(!arr.includes(id)) arr.push(id), localStorage.setItem('ft_mySchedules',JSON.stringify(arr));
          updateLive();
        }
        if(btn.classList.contains('join-btn')){
          location.href=`live.html?session=${btn.dataset.id}`;
        }
      };

    function updateMini(){
      const list=JSON.parse(localStorage.getItem('ft_leaderboard')||'[]')
                   .sort((a,b)=>b.score-a.score).slice(0,5),
            ol=document.getElementById('miniLeaderboard');
      ol.innerHTML='';
      list.forEach(u=>{
        const li=document.createElement('li');
        li.textContent=`${u.name}: ${u.score}`;
        ol.appendChild(li);
      });
    }

    function updateAch(){
      const acts=JSON.parse(localStorage.getItem('ft_activities')||'[]'),
            thresh=[1,5,10,30],
            grid=document.getElementById('yourAchievements');
      grid.innerHTML='';
      thresh.forEach(n=>{
        const div=document.createElement('div');
        const icon = n===1?'fas fa-star':
                     n===5?'fas fa-medal':
                     n===10?'fas fa-trophy':'fas fa-award';
        div.className='achievement-badge'+(acts.length>=n?' unlocked':'');
        div.innerHTML=`<i class="${icon}"></i><p>${n} Workouts</p>`;
        grid.appendChild(div);
      });
    }

    // ‚îÄ‚îÄ‚îÄ 9) tip + initial ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function updateAll(){
      updateProfileSummary();
      updateStats(); updateCharts();
      updateRecent(); updateTip();
      updateLive(); updateMini(); updateAch();
    }
    updateAll();

    // ‚îÄ‚îÄ‚îÄ 10) live‚Äëstorage listener ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    window.addEventListener('storage', e=>{
      if (['ft_activities','ft_profile','ft_leaderboard','ft_liveSessions','ft_mySchedules'].includes(e.key)) {
        updateAll();
      }
    });
  });
  </script>
</body>
</html>
