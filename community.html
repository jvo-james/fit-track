<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>FitTrack | Community</title>

  <!-- Google Fonts & FontAwesome -->

  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>


  <style>
    /* ‚Üê exactly your leaderboard.html styles‚Ä¶ */
    :root {
      --bg: #000;
      --gold: #ff9800;
      --white: #fff;
      --accent: rgba(255,255,255,0.05);
      --font-base: 'Raleway', sans-serif;
      --font-head: 'Poppins', sans-serif;
      --sidebar-w: 80px;
      --mobile-w: 200px;
      --transition: .3s;
    }
    *,*::before,*::after { margin:0; padding:0; box-sizing:border-box; }
    body {
      display:flex; min-height:100vh;
      background:var(--bg); color:var(--white);
      font-family:var(--font-base); overflow-x:hidden;
    }
    a { color:inherit; text-decoration:none; }
    button { font-family:var(--font-head); cursor:pointer; border:none; background:none; transition:var(--transition); }

    /* Overlay */
    #overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:90; }
    #overlay.active { display:block; }

    /* Notification Banner */
    #completeProfileBanner {
      display:none; position:fixed; top:1rem; left:50%; transform:translateX(-50%);
      background:rgba(255,152,0,0.1); border-left:4px solid var(--gold);
      padding:.8rem 1.5rem; color:var(--white); z-index:2000;
    }

    /* SIDEBAR */
    .sidebar {
      width:var(--sidebar-w);
      background:rgba(0,0,0,0.9);
      border-right:2px solid var(--gold);
      display:flex; flex-direction:column; align-items:center;
      padding:1rem 0; position:sticky; top:0; height:100vh;
      z-index:1000;
    }
    @media(max-width:600px){
      .sidebar { position: fixed; left: -100%; width: var(--mobile-w); }
      .sidebar.open { left: 0; }
    }
    .sidebar .logo { font-size:1.8rem; color:var(--gold); margin-bottom:2rem; }
    .sidebar a.menu-item, .sidebar button.profile-menu {
      width:100%; padding:.8rem 0;
      display:flex; flex-direction:column; align-items:center; gap:.3rem;
      background:transparent; color:var(--white);
      transition:background var(--transition);
    }
    .sidebar a.menu-item.active,
    .sidebar a.menu-item:hover,
    .sidebar button.profile-menu:hover {
      background:rgba(255,152,0,0.2);
    }
    .sidebar a.menu-item i,
    .sidebar button.profile-menu i.avatar { font-size:1.4rem; }
    .sidebar a.menu-item span,
    .sidebar button.profile-menu span   { font-size:.75rem; }
    .sidebar a.sign-out { margin-top:auto; margin-bottom:1rem!important; }
    img.avatar, i.avatar {
      width:32px; height:32px; border-radius:50%;
      object-fit:cover; border:2px solid var(--white);
    }

    /* Main & Header */
    .main { flex:1; display:flex; flex-direction:column; }
    @media(max-width:600px){ .main { margin-left:0; } }
    header {
      display:flex; align-items:center; justify-content:space-between;
      padding:1rem 1.5rem; background:rgba(0,0,0,0.9);
      border-bottom:2px solid var(--gold);
      position:sticky; top:0; width:100%; z-index:200;
    }
    .hamburger { display:none; font-size:1.4rem; }
    .logo-header { font-family:var(--font-head); font-size:1.4rem; color:var(--gold); }
    .search input {
      padding:.4rem .6rem; background:var(--accent);
      border:1px solid var(--accent); border-radius:6px; color:var(--white);
    }
    .controls { display:flex; align-items:center; gap:.5rem; }
    .controls select, .controls button {
      padding:.4rem .6rem; background:var(--accent);
      border:1px solid var(--accent); border-radius:6px; color:var(--white);
    }
    .avatar-btn img { width:32px; height:32px; border-radius:50%; object-fit:cover; }
    @media(max-width:600px){
      .hamburger { display:block; }
      .search, .controls select { display:none; }
    }

    /* CONTENT WRAPPER */
    .container { flex:1; overflow-y:auto; padding:1rem; }

    /*‚Äî COMMUNITY FEED SPECIFIC ‚Äî*/
    .post-box {
      background: var(--accent);
      padding: 1rem;
      border-radius: 8px;
      display: flex;
      gap: .75rem;
      margin-bottom: 1.5rem;
    }
    .post-box input {
      flex: 1;
      padding: .6rem;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.05);
      color: var(--white);
    }
    .post-box button {
      background: var(--gold);
      border: none;
      color: var(--bg);
      padding: .6rem 1.2rem;
      border-radius: 20px;
      cursor: pointer;
    }

    .feed-list { list-style:none; padding:0; }
    .feed-item {
      background: var(--accent);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      position: relative;
    }
    .feed-header {
      display: flex; align-items:center; gap:.75rem;
    }
    .feed-avatar {
      width: 36px; height:36px;
      border-radius:50%;
      object-fit:cover;
      background:#555;
    }
    .feed-meta .user { color:var(--gold); font-weight:600; }
    .feed-meta .time { font-size:.8rem; color:var(--white); opacity:.6; }
    .feed-text { margin: .75rem 0; line-height:1.4; }
    .feed-controls {
      display: flex; gap:1.2rem;
      border-top:1px solid rgba(255,255,255,0.1);
      padding-top:.75rem;
    }
    .feed-controls button {
      background:none; border:none; color:var(--white);
      cursor:pointer; display:flex; align-items:center; gap:.4rem;
      transition:color .2s;
    }
    .feed-controls button:hover { color:var(--gold); }
    .comments-container {
      max-height:0; overflow:hidden;
      transition:max-height .3s ease;
      margin-top:.75rem; border-top:1px solid rgba(255,255,255,0.1);
      padding-top:.75rem;
    }
    .comments-container.open { max-height:600px; }
    .comment-item {
      display:flex; align-items:flex-start; gap:.6rem; margin-bottom:.6rem;
    }
    .comment-avatar {
      width:28px; height:28px; border-radius:50%; object-fit:cover; background:#777;
    }
    .comment-content {
      background: rgba(255,255,255,0.05);
      padding:.5rem .75rem;
      border-radius:6px;
      flex:1;
    }
    .comment-content .author { color:var(--gold); font-weight:600; margin-bottom:.2rem; }
    .comment-content .text  { line-height:1.3; }

    /* Chatbot */
    .chatbot { display: none !important; }
    .chatbot.active { display: flex !important; }
  </style>

</head>

<body>
   <!-- Profile‚Äêcompletion banner -->
  <div id="completeProfileBanner">
    üëã Don‚Äôt forget to <a href="profile.html">complete your profile</a>!
  </div>

  <!-- Sidebar -->

  <div id="overlay" onclick="toggleSidebar()"></div>
  <aside class="sidebar" id="sidebar">
    <div class="logo"><i class="fas fa-heartbeat"></i></div>
    <a href="dashboard.html" class="menu-item"><i class="fas fa-tachometer-alt"></i><span>Dash</span></a>
    <a href="log.html"       class="menu-item"><i class="fas fa-pen"></i><span>Log</span></a>
    <a href="workouts.html"  class="menu-item"><i class="fas fa-dumbbell"></i><span>Workouts</span></a>
    <a href="leaderboard.html" class="menu-item"><i class="fas fa-trophy"></i><span>Board</span></a>
    <a href="community.html" class="menu-item active"><i class="fas fa-users"></i><span>Community</span></a>
    <button class="menu-item profile-menu" id="profileBtn">
      <i class="fas fa-user-circle avatar" id="side-avatar"></i><span>Profile</span>
    </button>
    <a href="signout.html" class="menu-item sign-out"><i class="fas fa-sign-out-alt"></i><span>Sign Out</span></a>
  </aside>


  <!-- Main content -->
  <div class="main">
    <header>
      <button class="hamburger" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
      <div class="logo-header"><i class="fas fa-users"></i> Community</div>
      <div class="controls">
        <button id="notifBtn"><i class="fas fa-bell"></i></button>
        <button class="avatar-btn" id="hdrAvatarBtn">
          <i class="fas fa-user-circle avatar" id="hdrAvatarIcon"></i>
        </button>
      </div>
    </header>

  <!-- 1. Getting-started banner -->
  <div class="community-intro" style="background:var(--accent);padding:1rem;border-radius:8px;margin:1rem;">
    <h2 style="color:var(--gold);margin-bottom:.5rem;">Welcome to FitTrack Community!</h2>
    <p>Share your workouts, cheer each other on, and join the conversation.  
       <strong>Tip:</strong> Click on a hashtag to filter, or start your own discussion below.</p>
  </div>

  <!-- 2. Trending Topics -->
  <div id="trending-topics" style="display:flex;gap:.5rem;flex-wrap:wrap;margin:0 1rem 1rem;">
    <strong style="color:var(--white);align-self:center;">Trending:</strong>
    <button class="tag-btn" data-tag="#HIIT">#HIIT</button>
    <button class="tag-btn" data-tag="#Yoga">#Yoga</button>
    <button class="tag-btn" data-tag="#Nutrition">#Nutrition</button>
    <button class="tag-btn" data-tag="#Running">#Running</button>
    <button class="tag-btn" data-tag="#Strength">#Strength</button>
    <button class="tag-btn" data-tag="All">All</button>
  </div>

  <!-- 3. Quick Poll -->
  <div id="poll-section" style="background:var(--accent);padding:1rem;border-radius:8px;margin:0 1rem 1.5rem;">
    <h3 style="color:var(--gold);margin-bottom:.5rem;">Poll: What‚Äôs your favorite workout time?</h3>
    <form id="pollForm">
      <label><input type="radio" name="when" value="Morning"/> Morning üåÖ</label><br/>
      <label><input type="radio" name="when" value="Afternoon"/> Afternoon ‚òÄÔ∏è</label><br/>
      <label><input type="radio" name="when" value="Evening"/> Evening üåô</label><br/>
      <button type="submit" style="margin-top:.5rem;padding:.4rem .8rem;border-radius:6px;">Vote</button>
    </form>
    <div id="pollResults" style="margin-top:.5rem;color:var(--white);"></div>
  </div>

  <!-- 4. New post box + feed -->
  <div class="container">
    <div class="post-box">
      <input id="newFeedInput" placeholder="Share something‚Ä¶"/>
      <button id="postFeedBtn"><i class="fas fa-paper-plane"></i> Post</button>
    </div>
    <ul class="feed-list" id="communityFeed"></ul>
  </div>

   </div> 
  <!-- Chatbot for Community -->
  <div id="lb-chatbot" class="chatbot">
    <header><i class="fas fa-comments"></i> Community Bot
      <button id="lb-chat-close">&times;</button>
    </header>
    <div class="messages" id="lb-chat-messages">
      <div class="msg bot">Hi! Ask me about the feed‚Ä¶</div>
    </div>
    <div class="input">
      <input list="lb-questions" id="lb-chat-input" placeholder="Your question‚Ä¶"/>
      <datalist id="lb-questions"></datalist>
      <button id="lb-ask-btn"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>
  <button id="lb-chat-toggle" class="chat-toggle"><i class="fas fa-comments"></i></button>


  <!-- SINGLE MODULE SCRIPT -->
  <script type="module">
    import { Storage } from './storage.js';

    document.addEventListener('DOMContentLoaded', () => {
      //‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
      const cur = Storage.get('ft_current') || {};
      const me    = cur.name;
      const myAvatar = cur.avatarDataUrl
        || `https://i.pravatar.cc/150?u=${encodeURIComponent(me||'guest')}`;

      function timeAgo(ts) {
        const diff = Date.now() - ts;
        const sec = Math.floor(diff/1000);
        if (sec < 60) return sec + 's ago';
        const min = Math.floor(sec/60);
        if (min < 60) return min + 'm ago';
        const hr  = Math.floor(min/60);
        if (hr < 24) return hr + 'h ago';
        const d   = Math.floor(hr/24);
        if (d < 7) return d + 'd ago';
        const wk  = Math.floor(d/7);
        if (wk < 5) return wk + 'w ago';
        const mo  = Math.floor(d/30);
        if (mo < 12) return mo + 'mo ago';
        const yr  = Math.floor(d/365);
        return yr + 'y ago';
      }

      //‚îÄ‚îÄ Redirect if not logged in ‚îÄ‚îÄ
      if (!me) return location.replace('home.html');

      // ‚îÄ‚îÄ Avatar sync for sidebar/header ‚îÄ‚îÄ
    function updateAvatars() {
      const p   = Storage.get('ft_current', {}) || {};
      const seed = encodeURIComponent(p.email || p.name);
      const url  = p.avatarDataUrl || `https://i.pravatar.cc/150?u=${seed}`;
      ['side-avatar','hdrAvatarIcon'].forEach(id => {
        const old = document.getElementById(id);
        if (!old) return;
        const img = document.createElement('img');
        img.id        = id;
        img.className = 'avatar';
        img.src       = url;
        img.alt       = 'Avatar';
        old.replaceWith(img);
      });
    }
    updateAvatars();
    Storage.onChange('ft_current', updateAvatars);

      //‚îÄ‚îÄ Sidebar toggle ‚îÄ‚îÄ
      window.toggleSidebar = () => {
        document.getElementById('sidebar').classList.toggle('open');
        document.getElementById('overlay').classList.toggle('active');
      };

      //‚îÄ‚îÄ Seed feed/comments ‚îÄ‚îÄ
      let feed  = Storage.get('ft_feed')     || [];
      let cmnts = Storage.get('ft_comments') || [];
      if (!feed.length || feed.length !== cmnts.length) {
        const users  = ['Alice','Bob','Cara','Dan','Eve','Finn','Gina','Hank','Ivy','Jack','Kara','Liam','Mia','Noah','Olive'];
        const texts  = [
        "Just crushed 10k steps today!",  "Morning HIIT session was üî•",  "Yoga helped my flexibility so much!",
        "Hit a new PR on deadlift: 120kg!", "Tried a new smoothie recipe üçìü•§", "Weekend trail run was epic!",
        "Group class at 6am? Count me in!", "Leg day left me walking funny üòÇ", "Protein pancakes for breakfast!",
        "Hit my weekly goal: 5 workouts!", "Cooldown stretches are underrated.", "First 50 pushups in a row!",
        "Beat my plank time: 2 minutes!", "Joined the 30-day squat challenge!", "Early bird workout = best mood!"
      ];
      const replies = ["Awesome!","Keep going!","You rock!","So inspiring!","Well done!","üî•üî•","Nice work!","Goals!","Legend!","üí™","Woo!","Amazing!"];


        feed = texts.map((t,i) => ({
          user: users[i],
          avatar: `https://i.pravatar.cc/40?u=${encodeURIComponent(users[i])}`,
          text: t, timestamp: Date.now() - Math.random()*3.6e6,
          likes: Math.floor(Math.random()*20)+15, likedBy: []
        }));

        cmnts = feed.map(() => {
          const n = 3 + Math.floor(Math.random()*5);
          return Array.from({length:n}).map(() => {
            const u = users[Math.floor(Math.random()*users.length)];
            return { user:u,
                     avatar:`https://i.pravatar.cc/40?u=${encodeURIComponent(u)}`,
                     text: replies[Math.floor(Math.random()*replies.length)],
                     timestamp: Date.now() - Math.random()*3.6e6,
                     likes: Math.floor(Math.random()*5),
                     likedBy: [] };
          });
        });

        Storage.set('ft_feed', feed);
        Storage.set('ft_comments', cmnts);
      }

      const feedEl = document.getElementById('communityFeed');

      //‚îÄ‚îÄ Render ‚îÄ‚îÄ
      function render(filterTag = 'All') {
        const f = Storage.get('ft_feed');
        const c = Storage.get('ft_comments');
        feedEl.innerHTML = '';

        f.forEach((post, idx) => {
          // Skip if filtering and no tag match
          if (filterTag!=='All' && !post.text.includes(filterTag)) return;

          const li = document.createElement('li');
          li.className = 'feed-item'; li.dataset.index = idx;
          // Build comment-input under each post
          li.innerHTML = `
            <div class="feed-header">
              <img class="feed-avatar" src="${post.avatar}"/>
              <div class="feed-meta">
                <span class="user">${post.user}</span>
                <span class="time">${timeAgo(post.timestamp)}</span>
              </div>
            </div>
            <div class="feed-text">${post.text}</div>
            <div class="feed-controls">
              <button class="like-btn"><i class="fas fa-heart"></i>
                <span class="like-count">${post.likes}</span>
              </button>
              <button class="toggle-comments">‚ñº ${c[idx].length} comments</button>
              <button class="share-btn"><i class="fas fa-share"></i> Share</button>
            </div>
            <div class="comments-container">
              ${c[idx].map((cm,ci)=>`
                <div class="comment-item" data-cidx="${ci}">
                  <img class="comment-avatar" src="${cm.avatar}"/>
                  <div class="comment-content">
                    <div style="display:flex;justify-content:space-between">
                      <span class="author">${cm.user}</span>
                      <span class="time">${timeAgo(cm.timestamp)}</span>
                    </div>
                    <div class="text">${cm.text}</div>
                    <div style="margin-top:.3rem;">
                      <button class="c-like-btn"><i class="fas fa-heart"></i>
                        <span>${cm.likes}</span>
                      </button>
                    </div>
                  </div>
                </div>
              `).join('')}
              <div class="add-comment" style="display:flex;gap:.5rem;margin-top:.5rem;">
                <img src="${myAvatar}" class="comment-avatar"/>
                <input class="new-comment-input" placeholder="Add a comment‚Ä¶"/>
                <button class="new-comment-btn">Post</button>
              </div>
            </div>
          `;
          feedEl.appendChild(li);
        });
      }

      //‚îÄ‚îÄ Post new feed ‚îÄ‚îÄ
      document.getElementById('postFeedBtn').addEventListener('click', () => {
        const txt = document.getElementById('newFeedInput').value.trim();
        if (!txt) return;
        const f = Storage.get('ft_feed');
        f.unshift({ user:me, avatar:myAvatar, text:txt, timestamp:Date.now(), likes:0, likedBy:[] });
        Storage.set('ft_feed', f);
        const c = Storage.get('ft_comments');
        c.unshift([]); Storage.set('ft_comments', c);
        document.getElementById('newFeedInput').value='';
        render();
      });

      //‚îÄ‚îÄ Delegated click handling ‚îÄ‚îÄ
      feedEl.addEventListener('click', e => {
        const postLi = e.target.closest('.feed-item');
        if (!postLi) return;
        const i = +postLi.dataset.index;
        const f = Storage.get('ft_feed');
        const c = Storage.get('ft_comments');

        // Like post
        if (e.target.closest('.like-btn')) {
          const meIdx = f[i].likedBy.indexOf(me);
          if (meIdx >= 0) f[i].likedBy.splice(meIdx,1), f[i].likes--;
          else           f[i].likedBy.push(me),   f[i].likes++;
          Storage.set('ft_feed',f);
          return render(currentFilter);
        }

        // Toggle comments
        if (e.target.closest('.toggle-comments')) {
          const cont = postLi.querySelector('.comments-container');
          cont.classList.toggle('open');
          return;
        }

        // Share (just alert for demo)
        if (e.target.closest('.share-btn')) {
          alert('Link copied!');
          return;
        }

        // Like a comment
        if (e.target.closest('.c-like-btn')) {
          const cmLi = e.target.closest('.comment-item');
          const ci   = +cmLi.dataset.cidx;
          const cm   = c[i][ci];
          const idx  = cm.likedBy.indexOf(me);
          if (idx>=0) cm.likedBy.splice(idx,1), cm.likes--;
          else         cm.likedBy.push(me),      cm.likes++;
          Storage.set('ft_comments',c);
          return render(currentFilter);
        }

        // Add a comment via the inline form
        if (e.target.closest('.new-comment-btn')) {
          const container = postLi.querySelector('.comments-container');
          const input     = container.querySelector('.new-comment-input');
          const text      = input.value.trim();
          if (!text) return;
          c[i].push({
            user:me, avatar:myAvatar,
            text, timestamp:Date.now(),
            likes:0, likedBy:[]
          });
          Storage.set('ft_comments',c);
          input.value='';
          return render(currentFilter);
        }
      });

      //‚îÄ‚îÄ Poll logic ‚îÄ‚îÄ
      document.getElementById('pollForm').addEventListener('submit', e => {
        e.preventDefault();
        const choice = pollForm.when.value;
        let results = JSON.parse(localStorage.getItem('ft_poll')||'{"Morning":0,"Afternoon":0,"Evening":0}');
        results[choice]++;
        localStorage.setItem('ft_poll', JSON.stringify(results));
        document.getElementById('pollResults').textContent =
          `Morning: ${results.Morning}, Afternoon: ${results.Afternoon}, Evening: ${results.Evening}`;
      });
      // show existing poll
      const saved = JSON.parse(localStorage.getItem('ft_poll')||'{"Morning":0,"Afternoon":0,"Evening":0}');
      document.getElementById('pollResults').textContent =
        `Morning: ${saved.Morning}, Afternoon: ${saved.Afternoon}, Evening: ${saved.Evening}`;

      //‚îÄ‚îÄ Trending-topic filtering ‚îÄ‚îÄ
      let currentFilter = 'All';
      document.querySelectorAll('.tag-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          currentFilter = btn.dataset.tag;
          render(currentFilter);
        });
      });

      //‚îÄ‚îÄ Chatbot toggles & initial paint ‚îÄ‚îÄ
      document.getElementById('lb-chat-toggle').onclick = () => {
        document.getElementById('lb-chatbot').classList.add('active');
        lb-chat-toggle.style.display='none';
      };
      document.getElementById('lb-chat-close').onclick = () => {
        document.getElementById('lb-chatbot').classList.remove('active');
        lb-chat-toggle.style.display='flex';
      };

      render();
    });
  </script>
</body>

</html>
