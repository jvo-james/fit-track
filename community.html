<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>FitTrack | Community</title>

  <!-- Google Fonts & FontAwesome -->

  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>


  <style>
    /* ‚Üê exactly your leaderboard.html styles‚Ä¶ */
    :root {
      --bg: #000;
      --gold: #ff9800;
      --white: #fff;
      --accent: rgba(255,255,255,0.05);
      --font-base: 'Raleway', sans-serif;
      --font-head: 'Poppins', sans-serif;
      --sidebar-w: 80px;
      --mobile-w: 200px;
      --transition: .3s;
    }
    *,*::before,*::after { margin:0; padding:0; box-sizing:border-box; }
    body {
      display:flex; min-height:100vh;
      background:var(--bg); color:var(--white);
      font-family:var(--font-base); overflow-x:hidden;
    }
    a { color:inherit; text-decoration:none; }
    button { font-family:var(--font-head); cursor:pointer; border:none; background:none; transition:var(--transition); }

    /* Overlay */
    #overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:90; }
    #overlay.active { display:block; }

    /* Notification Banner */
    #completeProfileBanner {
      display:none; position:fixed; top:1rem; left:50%; transform:translateX(-50%);
      background:rgba(255,152,0,0.1); border-left:4px solid var(--gold);
      padding:.8rem 1.5rem; color:var(--white); z-index:2000;
    }

    /* SIDEBAR */
    .sidebar {
      width:var(--sidebar-w);
      background:rgba(0,0,0,0.9);
      border-right:2px solid var(--gold);
      display:flex; flex-direction:column; align-items:center;
      padding:1rem 0; position:sticky; top:0; height:100vh;
      z-index:1000;
    }
    @media(max-width:600px){
      .sidebar { position: fixed; left: -100%; width: var(--mobile-w); }
      .sidebar.open { left: 0; }
    }
    .sidebar .logo { font-size:1.8rem; color:var(--gold); margin-bottom:2rem; }
    .sidebar a.menu-item, .sidebar button.profile-menu {
      width:100%; padding:.8rem 0;
      display:flex; flex-direction:column; align-items:center; gap:.3rem;
      background:transparent; color:var(--white);
      transition:background var(--transition);
    }
    .sidebar a.menu-item.active,
    .sidebar a.menu-item:hover,
    .sidebar button.profile-menu:hover {
      background:rgba(255,152,0,0.2);
    }
    .sidebar a.menu-item i,
    .sidebar button.profile-menu i.avatar { font-size:1.4rem; }
    .sidebar a.menu-item span,
    .sidebar button.profile-menu span   { font-size:.75rem; }
    .sidebar a.sign-out { margin-top:auto; margin-bottom:1rem!important; }
    img.avatar, i.avatar {
      width:32px; height:32px; border-radius:50%;
      object-fit:cover; border:2px solid var(--white);
    }

    /* Main & Header */
    .main { flex:1; display:flex; flex-direction:column; }
    @media(max-width:600px){ .main { margin-left:0; } }
    header {
      display:flex; align-items:center; justify-content:space-between;
      padding:1rem 1.5rem; background:rgba(0,0,0,0.9);
      border-bottom:2px solid var(--gold);
      position:sticky; top:0; width:100%; z-index:200;
    }
    .hamburger { display:none; font-size:1.4rem; }
    .logo-header { font-family:var(--font-head); font-size:1.4rem; color:var(--gold); }
    .search input {
      padding:.4rem .6rem; background:var(--accent);
      border:1px solid var(--accent); border-radius:6px; color:var(--white);
    }
    .controls { display:flex; align-items:center; gap:.5rem; }
    .controls select, .controls button {
      padding:.4rem .6rem; background:var(--accent);
      border:1px solid var(--accent); border-radius:6px; color:var(--white);
    }
    .avatar-btn img { width:32px; height:32px; border-radius:50%; object-fit:cover; }
    @media(max-width:600px){
      .hamburger { display:block; }
      .search, .controls select { display:none; }
    }

    /* CONTENT WRAPPER */
    .container { flex:1; overflow-y:auto; padding:1rem; }

    /*‚Äî COMMUNITY FEED SPECIFIC ‚Äî*/
    .post-box {
      background: var(--accent);
      padding: 1rem;
      border-radius: 8px;
      display: flex;
      gap: .75rem;
      margin-bottom: 1.5rem;
    }
    .post-box input {
      flex: 1;
      padding: .6rem;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.05);
      color: var(--white);
    }
    .post-box button {
      background: var(--gold);
      border: none;
      color: var(--bg);
      padding: .6rem 1.2rem;
      border-radius: 20px;
      cursor: pointer;
    }

    .feed-list { list-style:none; padding:0; }
    .feed-item {
      background: var(--accent);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      position: relative;
    }
    .feed-header {
      display: flex; align-items:center; gap:.75rem;
    }
    .feed-avatar {
      width: 36px; height:36px;
      border-radius:50%;
      object-fit:cover;
      background:#555;
    }
    .feed-meta .user { color:var(--gold); font-weight:600; }
    .feed-meta .time { font-size:.8rem; color:var(--white); opacity:.6; }
    .feed-text { margin: .75rem 0; line-height:1.4; }
    .feed-controls {
      display: flex; gap:1.2rem;
      border-top:1px solid rgba(255,255,255,0.1);
      padding-top:.75rem;
    }
    .feed-controls button {
      background:none; border:none; color:var(--white);
      cursor:pointer; display:flex; align-items:center; gap:.4rem;
      transition:color .2s;
    }
    .feed-controls button:hover { color:var(--gold); }
    .comments-container {
      max-height:0; overflow:hidden;
      transition:max-height .3s ease;
      margin-top:.75rem; border-top:1px solid rgba(255,255,255,0.1);
      padding-top:.75rem;
    }
    .comments-container.open { max-height:600px; }
    .comment-item {
      display:flex; align-items:flex-start; gap:.6rem; margin-bottom:.6rem;
    }
    .comment-avatar {
      width:28px; height:28px; border-radius:50%; object-fit:cover; background:#777;
    }
    .comment-content {
      background: rgba(255,255,255,0.05);
      padding:.5rem .75rem;
      border-radius:6px;
      flex:1;
    }
    .comment-content .author { color:var(--gold); font-weight:600; margin-bottom:.2rem; }
    .comment-content .text  { line-height:1.3; }

    /* Chatbot */
    .chatbot { display: none !important; }
    .chatbot.active { display: flex !important; }
  </style>

</head>


<body>
  <!-- Profile‚Äêcompletion banner -->
  <div id="completeProfileBanner">
    üëã Don‚Äôt forget to <a href="profile.html">complete your profile</a>!
  </div>

 <!-- Sidebar -->

  <div id="overlay" onclick="toggleSidebar()"></div>
  <aside class="sidebar" id="sidebar">
    <div class="logo"><i class="fas fa-heartbeat"></i></div>
    <a href="dashboard.html" class="menu-item"><i class="fas fa-tachometer-alt"></i><span>Dash</span></a>
    <a href="log.html"       class="menu-item"><i class="fas fa-pen"></i><span>Log</span></a>
    <a href="workouts.html"  class="menu-item"><i class="fas fa-dumbbell"></i><span>Workouts</span></a>
    <a href="leaderboard.html" class="menu-item"><i class="fas fa-trophy"></i><span>Board</span></a>
    <a href="community.html" class="menu-item active"><i class="fas fa-users"></i><span>Community</span></a>
    <button class="menu-item profile-menu" id="profileBtn">
      <i class="fas fa-user-circle avatar" id="side-avatar"></i><span>Profile</span>
    </button>
    <a href="signout.html" class="menu-item sign-out"><i class="fas fa-sign-out-alt"></i><span>Sign Out</span></a>
  </aside>


  <!-- Main content -->
  <div class="main">
    <header>
      <button class="hamburger" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
      <div class="logo-header"><i class="fas fa-users"></i> Community</div>
      <div class="controls">
        <button id="notifBtn"><i class="fas fa-bell"></i></button>
        <button class="avatar-btn" id="hdrAvatarBtn">
          <i class="fas fa-user-circle avatar" id="hdrAvatarIcon"></i>
        </button>
      </div>
    </header>

  <!-- 1. Getting-started banner -->
  <div class="community-intro" style="background:var(--accent);padding:1rem;border-radius:8px;margin:1rem;">
    <h2 style="color:var(--gold);margin-bottom:.5rem;">Welcome to FitTrack Community!</h2>
    <p>Share your workouts, cheer each other on, and join the conversation.  
       <strong>Tip:</strong> Click on a hashtag to filter, or start your own discussion below.</p>
  </div>

   
  <!-- 2. Trending Topics -->
  <div id="trending-topics" style="display:flex;gap:.5rem;flex-wrap:wrap;margin:0 1rem 1rem;">
    <strong style="color:var(--white);align-self:center;">Trending:</strong>
    <button class="tag-btn" data-tag="#HIIT">#HIIT</button>
    <button class="tag-btn" data-tag="#Yoga">#Yoga</button>
    <button class="tag-btn" data-tag="#Nutrition">#Nutrition</button>
    <button class="tag-btn" data-tag="#Running">#Running</button>
    <button class="tag-btn" data-tag="#Strength">#Strength</button>
    <button class="tag-btn" data-tag="All">All</button>
  </div>

    <!-- 3. Quick Poll -->
    <div id="poll-section">
      <h3>Poll: What‚Äôs your favorite workout time?</h3>
      <form id="pollForm">
        <label><input type="radio" name="when" value="Morning"/>Morning üåÖ</label><br/>
        <label><input type="radio" name="when" value="Afternoon"/>Afternoon ‚òÄÔ∏è</label><br/>
        <label><input type="radio" name="when" value="Evening"/> Evening üåô</label><br/>
        <button type="submit">Vote</button>
      </form>
      <div id="pollResults"></div>
    </div>

    <!-- 4. New post + feed -->
    <div class="container">
      <div class="post-box">
        <input id="newFeedInput" placeholder="Share something‚Ä¶"/>
        <button id="postFeedBtn"><i class="fas fa-paper-plane"></i> Post</button>
      </div>
      <ul class="feed-list" id="communityFeed"></ul>
    </div>
  </div>

  <!-- Chatbot -->
  <div id="lb-chatbot" class="chatbot">
 <header><i class="fas fa-comments"></i> Community Bot
      <button id="lb-chat-close">&times;</button>
    </header>
    <div class="messages" id="lb-chat-messages">
      <div class="msg bot">Hi! Ask me about the feed‚Ä¶</div>
    </div>
    <div class="input">
      <input list="lb-questions" id="lb-chat-input" placeholder="Your question‚Ä¶"/>
      <datalist id="lb-questions"></datalist>
      <button id="lb-ask-btn"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>
  <button id="lb-chat-toggle" class="chat-toggle"><i class="fas fa-comments"></i></button>

 <script type="module">
  import { Storage } from './storage.js';

  document.addEventListener('DOMContentLoaded', () => {
    // ‚Äî Helpers & State ‚Äî
    const cur      = Storage.get('ft_current') || {};
    const me       = cur.name || '';
    const myAvatar = cur.avatarDataUrl || `https://i.pravatar.cc/150?u=${encodeURIComponent(me)}`;

    let feed       = [];
    let cmnts      = [];
    let currentTag = 'All';

    function timeAgo(ts) {
      if (!ts || isNaN(ts)) return '';
      const diff = Date.now() - ts;
      const sec  = Math.floor(diff/1000);
      if (sec < 60) return `${sec}s`;
      const min = Math.floor(sec/60);
      if (min < 60) return `${min}m`;
      const hr  = Math.floor(min/60);
      if (hr < 24) return `${hr}h`;
      const d   = Math.floor(hr/24);
      if (d < 7)  return `${d}d`;
      const wk  = Math.floor(d/7);
      if (wk < 5) return `${wk}w`;
      const mo  = Math.floor(d/30);
      if (mo < 12) return `${mo}mo`;
      return `${Math.floor(d/365)}y`;
    }

    // ‚Äî Redirect if not logged in ‚Äî
    if (!me) return location.replace('home.html');

    // ‚Äî Avatar sync ‚Äî
    function updateAvatars() {
      ['side-avatar','hdrAvatarIcon'].forEach(id => {
        const old = document.getElementById(id);
        if (!old) return;
        const img = document.createElement('img');
        img.id        = id;
        img.className = 'avatar';
        img.src       = myAvatar;
        img.alt       = 'You';
        old.replaceWith(img);
      });
    }
    updateAvatars();
    Storage.onChange('ft_current', updateAvatars);

    // ‚Äî Sidebar toggle ‚Äî
    window.toggleSidebar = () => {
      document.getElementById('sidebar').classList.toggle('open');
      document.getElementById('overlay').classList.toggle('active');
    };

    // ‚Äî Seed feed & comments once or if out-of-sync ‚Äî
    function seedData() {
      const u = ['Alice','Bob','Cara','Dan','Eve','Finn','Gina','Hank','Ivy','Jack','Kara','Liam','Mia','Noah','Olive'];
      const t = [
        "Just crushed 10k steps today! #Running",
        "Morning #HIIT session was üî•",
        "Yoga helped my flexibility so much! #Yoga",
        "Hit a new PR on deadlift: 120kg! #Strength",
        "Tried a new smoothie recipe üçìü•§ #Nutrition",
        "Weekend trail run was epic! #Running",
        "Group class at 6am? Count me in! #HIIT",
        "Leg day left me walking funny üòÇ #Strength",
        "Protein pancakes for breakfast! #Nutrition",
        "Hit my weekly goal: 5 workouts! #Fitness",
        "Cooldown stretches are underrated. #Yoga",
        "First 50 pushups in a row! #Strength",
        "Beat my plank time: 2 minutes! #HIIT",
        "Joined the 30-day squat challenge! #Strength",
        "Early bird workout = best mood! #Morning"
      ];
      const r = ["Awesome!","Keep going!","You rock!","So inspiring!","Well done!","üî•","Nice work!","Goals!"];

      feed = t.map((text,i) => ({
        id: i,
        user: u[i],
        avatar: `https://i.pravatar.cc/40?u=${encodeURIComponent(u[i])}`,
        text,
        timestamp: Date.now() - Math.random()*3600000,
        likes: Math.floor(Math.random()*20)+5,
        likedBy: []
      }));
      cmnts = feed.map(() => {
        const n = 2 + Math.floor(Math.random()*4);
        return Array.from({length:n}).map(() => ({
          user: u[Math.floor(Math.random()*u.length)],
          avatar: `https://i.pravatar.cc/40?u=${encodeURIComponent(u[Math.floor(Math.random()*u.length)])}`,
          text: r[Math.floor(Math.random()*r.length)],
          timestamp: Date.now() - Math.random()*3600000,
          likes: Math.floor(Math.random()*5),
          likedBy: []
        }));
      });
      Storage.set('ft_feed', feed);
      Storage.set('ft_comments', cmnts);
    }

    feed  = Storage.get('ft_feed')     || [];
    cmnts = Storage.get('ft_comments') || [];
    if (!feed.length || feed.length !== cmnts.length) seedData();

    // ‚Äî Render ‚Äî
    const feedEl = document.getElementById('communityFeed');
    function render() {
      const f = Storage.get('ft_feed');
      const c = Storage.get('ft_comments');
      feedEl.innerHTML = '';
      f.forEach(post => {
        if (currentTag !== 'All' && !post.text.includes(currentTag)) return;
        const idx = post.id;
        const commentsHtml = (c[idx]||[]).map((cm,j) => `
          <div class="comment-item" data-post="${idx}" data-cidx="${j}">
            <img class="comment-avatar" src="${cm.avatar}"/>
            <div class="comment-content">
              <div style="display:flex;justify-content:space-between">
                <span class="author">${cm.user}</span>
                <span class="time">${timeAgo(cm.timestamp)}</span>
              </div>
              <p class="text">${cm.text}</p>
              <button class="c-like-btn">
                <i class="fas fa-heart${cm.likedBy.includes(me)?''+ ' active':''}"></i>
                <span>${cm.likes}</span>
              </button>
            </div>
          </div>
        `).join('');

        feedEl.insertAdjacentHTML('beforeend', `
          <li class="feed-item" data-index="${idx}">
            <div class="feed-header">
              <img class="feed-avatar" src="${post.avatar}"/>
              <div class="feed-meta">
                <span class="user">${post.user}</span>
                <span class="time">${timeAgo(post.timestamp)}</span>
              </div>
            </div>

            <p class="feed-text">${post.text}</p>

            <div class="feed-controls">
              <button class="like-btn">
                <i class="fas fa-heart${post.likedBy.includes(me)?' active':''}"></i>
                <span>${post.likes}</span>
              </button>
              <button class="toggle-comments">‚ñº ${c[idx]?.length||0} comments</button>
              <button class="share-btn"><i class="fas fa-share"></i> Share</button>
            </div>

            <div class="comments-container">
              ${commentsHtml}
              <div class="add-comment">
                <img class="comment-avatar" src="${myAvatar}"/>
                <input class="new-comment-input" placeholder="Add a comment‚Ä¶"/>
                <button class="new-comment-btn">Post</button>
              </div>
            </div>
          </li>
        `);
      });
    }

    // ‚Äî Handlers ‚Äî  
    // Post a new feed
    document.getElementById('postFeedBtn').onclick = () => {
      const txt = document.getElementById('newFeedInput').value.trim();
      if (!txt) return;
      const f = Storage.get('ft_feed');
      const id = f.length ? f[0].id + 1 : 0;
      f.unshift({ id, user:me, avatar:myAvatar, text:txt, timestamp:Date.now(), likes:0, likedBy:[] });
      Storage.set('ft_feed', f);
      const c = Storage.get('ft_comments');
      c.unshift([]);
      Storage.set('ft_comments', c);
      document.getElementById('newFeedInput').value = '';
      render();
    };

    // Delegate clicks: like/unlike, toggle comments, share, comment-like, post comment
    feedEl.onclick = async e => {
      const postLi = e.target.closest('.feed-item');
      if (!postLi) return;
      const idx = +postLi.dataset.index;
      let f = Storage.get('ft_feed');
      let c = Storage.get('ft_comments');

      // Like post
      if (e.target.closest('.like-btn')) {
        const p = f.find(p=>p.id===idx);
        const i = p.likedBy.indexOf(me);
        if (i>=0) { p.likedBy.splice(i,1); p.likes--;}
        else     { p.likedBy.push(me);    p.likes++;}
        Storage.set('ft_feed', f);
        return render();
      }

      // Toggle comments
      if (e.target.closest('.toggle-comments')) {
        postLi.querySelector('.comments-container').classList.toggle('open');
        return;
      }

      // Share post
      if (e.target.closest('.share-btn')) {
        const link = `${location.origin}${location.pathname}#post-${idx}`;
        await navigator.clipboard.writeText(link);
        alert('Link copied to clipboard!');
        return;
      }

      // Like comment
      if (e.target.closest('.c-like-btn')) {
        const cmLi = e.target.closest('.comment-item');
        const j    = +cmLi.dataset.cidx;
        const cm   = c[idx][j];
        const i2   = cm.likedBy.indexOf(me);
        if (i2>=0) { cm.likedBy.splice(i2,1); cm.likes--; }
        else       { cm.likedBy.push(me);      cm.likes++; }
        Storage.set('ft_comments', c);
        return render();
      }

      // Post inline comment
      if (e.target.closest('.new-comment-btn')) {
        const container = postLi.querySelector('.comments-container');
        const input     = container.querySelector('.new-comment-input');
        const txt       = input.value.trim();
        if (!txt) return;
        c[idx].push({ user:me, avatar:myAvatar, text:txt, timestamp:Date.now(), likes:0, likedBy:[] });
        Storage.set('ft_comments', c);
        render();
      }
    };

    // ‚Äî Poll UI ‚Äî
    const pollForm    = document.getElementById('pollForm');
    const pollResults = document.getElementById('pollResults');
    const pollData    = JSON.parse(localStorage.getItem('ft_poll') || '{"Morning":0,"Afternoon":0,"Evening":0}');
    function renderPoll() {
      pollResults.innerHTML = Object.entries(pollData).map(
        ([k,v]) => `<div style="margin:.3rem 0">
          <strong>${k}</strong> <span>${v} votes</span>
          <div style="background:rgba(255,255,255,.1);border-radius:4px;overflow:hidden;margin-top:.2rem;">
            <div style="width:${(v/(pollData.Morning+pollData.Afternoon+pollData.Evening)||0)*100}%;height:.6rem;background:var(--gold);"></div>
          </div>
        </div>`).join('');
    }
    renderPoll();
    pollForm.onsubmit = e => {
      e.preventDefault();
      const ch = pollForm.when.value;
      pollData[ch]++;
      localStorage.setItem('ft_poll', JSON.stringify(pollData));
      renderPoll();
    };

    // ‚Äî Trending Tags ‚Äî
    document.querySelectorAll('.tag-btn').forEach(btn => {
      btn.onclick = () => {
        currentTag = btn.dataset.tag;
        document.querySelectorAll('.tag-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        render();
      };
    });

    // ‚Äî Chatbot toggle ‚Äî
    document.getElementById('lb-chat-toggle').onclick = () => {
      document.getElementById('lb-chatbot').classList.add('active');
      document.getElementById('lb-chat-toggle').style.display = 'none';
    };
    document.getElementById('lb-chat-close').onclick = () => {
      document.getElementById('lb-chatbot').classList.remove('active');
      document.getElementById('lb-chat-toggle').style.display = 'flex';
    };

    // ‚Äî Initial paint ‚Äî
    render();
  });
</script>

</body>
</html>
