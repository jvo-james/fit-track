<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>FitTrack | Profile</title>

  <!-- Google Fonts & FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <script defer src="https://kit.fontawesome.com/a2e8f1b6b1.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
  :root {
    --bg: #0d0d0d;
    --fg: #fff;
    --accent: rgba(255,255,255,0.05);
    --input-bg: rgba(255,255,255,0.1);
    --gold: #ff9800;
    --font-base: 'Raleway', sans-serif;
    --font-head: 'Poppins', sans-serif;
    --transition: .3s ease;
    --sidebar-w: 80px;
    --mobile-sidebar-w: 200px;
    --overlay-z: 90;
    --sidebar-z: 100;
    --header-z: 200;
  }
  *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
  body {
    display:flex; min-height:100vh;
    background:var(--bg); color:var(--fg);
    font-family:var(--font-base);
    
  }
  a { color:inherit; text-decoration:none; }

  /* Only .container scrolls */
  .container { flex:1; overflow-y:auto; overflow-x:hidden; }

  /* Overlay */
  #overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.5);
    opacity:0; visibility:hidden; transition:opacity var(--transition);
    z-index:var(--overlay-z);
  }
  #overlay.active { opacity:1; visibility:visible; }

  /* Sidebar */
  .sidebar {
    width:var(--sidebar-w); background:rgba(0,0,0,0.9);
    border-right:2px solid var(--gold);
    display:flex; flex-direction:column; align-items:center;
    padding-top:1rem; position:sticky; top:0; height:100vh;
    z-index:var(--sidebar-z);
  }
  .sidebar-close {
    display:none; position:absolute; top:0.5rem; right:0.5rem;
    font-size:1.5rem; background:none; color:var(--fg);
  }
  .sidebar .logo { font-size:1.6rem; color:var(--gold); margin-bottom:1.5rem; }
  .sidebar a.menu-item,
  .sidebar button.profile-menu {
    width:100%; padding:.8rem 0;
    display:flex; flex-direction:column; align-items:center; gap:.3rem;
    color:var(--fg); background:none; border:none;
    transition:background var(--transition);
  }
  .sidebar a.menu-item:hover,
  .sidebar a.menu-item.active,
  .sidebar button.profile-menu:hover {
    background:var(--accent);
  }
  .sidebar a.menu-item i,
  .sidebar button.profile-menu i {
    font-size:1.2rem; color:var(--gold);
  }
  .sidebar a.menu-item span,
  .sidebar button.profile-menu span { font-size:.75rem; }
  .sidebar a.sign-out { margin-top:auto; margin-bottom:1rem; }

  /* Main + Header */
  .main { flex:1; display:flex; flex-direction:column; height: 100%; }
  header {
    position:sticky; top:0; background:rgba(0,0,0,0.9);
    border-bottom:2px solid var(--gold);
    padding:1rem 1.5rem; display:flex; align-items:center; justify-content:space-between;
    z-index:var(--header-z);
  }
  header h1 { color:var(--gold); font-family:var(--font-head); font-size:1.6rem; }
  .header-controls { display:flex; align-items:center; gap:1rem; }
  .header-controls button {
    background:none; border:none; color:var(--fg); cursor:pointer; font-size:1.2rem;
  }
  .avatar-btn {
    width:36px; height:36px; border:2px solid var(--gold); border-radius:50%;
    overflow:hidden; display:flex; align-items:center; justify-content:center;
  }
  .avatar-btn img { width:100%; height:100%; object-fit:cover; }

  /* Profile form */
  .content { padding:2rem; }
  #profileForm {
    max-width:900px; margin:0 auto; background:var(--accent);
    border-radius:12px; padding:2rem;
    display:grid; grid-template-columns:1fr 2fr; gap:2rem;
  }
  .avatar-section {
    display:flex; flex-direction:column; align-items:center; gap:1rem;
  }
  #avatarPreview {
    width:160px; height:160px; border-radius:50%;
    background:var(--input-bg); display:flex; align-items:center; justify-content:center;
    font-size:4rem; color:rgba(255,255,255,0.5); overflow:hidden;
  }
  .avatar-buttons { display:flex; gap:.5rem; }
  .avatar-buttons button {
    background:var(--gold); color:var(--bg); border:none;
    padding:.4rem .8rem; border-radius:6px; cursor:pointer;
  }

  .fields { display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; }
  .field { display:flex; flex-direction:column; }
  .field label {
    margin-bottom:.3rem; font-weight:600; font-family:var(--font-head);
  }
  .field input, .field select, .field textarea {
    padding:.6rem; border-radius:6px; border:1px solid rgba(255,255,255,0.3);
    background:var(--input-bg); color:var(--fg); font-size:1rem;
  }
  .field textarea { resize:vertical; min-height:80px; grid-column:span 2; }

  .actions {
    grid-column:span 2; display:flex; justify-content:flex-end;
  }
  .actions button {
    background:var(--gold); color:var(--bg); border:none;
    padding:.75rem 1.5rem; border-radius:30px; cursor:pointer;
    font-weight:600;
  }

  /* Responsive */
  @media(max-width:900px) {
    .sidebar { position:fixed; transform:translateX(-100%); }
    .sidebar.open { transform:translateX(0); }
    .sidebar-close { display:block; }

    #profileForm { grid-template-columns:1fr; }
    .fields { grid-template-columns:1fr; }
    .field textarea { grid-column:span 1; }
  }
  </style>
</head>
<body>
  <div id="overlay"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="logo"><i class="fas fa-heartbeat"></i></div>
    <button class="sidebar-close" id="sidebar-close">&times;</button>
    <a href="dashboard.html"   class="menu-item"><i class="fas fa-tachometer-alt"></i><span>Dash</span></a>
    <a href="log.html"         class="menu-item"><i class="fas fa-pen"></i><span>Log</span></a>
    <a href="workouts.html"    class="menu-item"><i class="fas fa-dumbbell"></i><span>Workouts</span></a>
    <a href="leaderboard.html" class="menu-item"><i class="fas fa-trophy"></i><span>Board</span></a>
    <button class="menu-item profile-menu"><i id="sideAvatar" class="fas fa-user-circle"></i><span>Profile</span></button>
    <a href="signout.html"     class="menu-item sign-out"><i class="fas fa-sign-out-alt"></i><span>Sign Out</span></a>
  </aside>

  <!-- Main -->
  <div class="main">
    <header>
      <h1>My Profile</h1>
      <div class="header-controls">
        <button id="logoutBtn"><i class="fas fa-sign-out-alt"></i></button>
        <button class="avatar-btn" id="hdrAvatarBtn">
          <i id="hdrAvatarIcon" class="fas fa-user-circle"></i>
        </button>
      </div>
    </header>

    <div class="container">
      <div class="content">
        <form id="profileForm">
          <!-- Avatar -->
          <div class="avatar-section">
            <div id="avatarPreview"><i class="fas fa-user"></i></div>
            <div class="avatar-buttons">
              <button type="button" id="changeAvatarBtn">Change</button>
              <button type="button" id="removeAvatarBtn">Remove</button>
            </div>
            <input type="file" id="avatarInput" accept="image/*" style="display:none;">
          </div>

          <!-- Fields -->
          <div class="fields">
            <div class="field">
              <label for="fullName">Full Name *</label>
              <input id="fullName" type="text" required>
            </div>
            <div class="field">
              <label for="email">Email</label>
              <input id="email" type="email" disabled>
            </div>
            <div class="field">
              <label for="bio">Bio</label>
              <textarea id="bio"></textarea>
            </div>
            <div class="field">
              <label for="location">Location</label>
              <input id="location" type="text">
            </div>
            <div class="field">
              <label for="age">Age</label>
              <input id="age" type="number" min="0">
            </div>
            <div class="field">
              <label for="gender">Gender</label>
              <select id="gender">
                <option value="">Prefer not to say</option>
                <option>Female</option>
                <option>Male</option>
                <option>Other</option>
              </select>
            </div>
            <div class="field">
              <label for="height">Height (cm)</label>
              <input id="height" type="number" min="0">
            </div>
            <div class="field">
              <label for="weight">Weight (kg)</label>
              <input id="weight" type="number" min="0">
            </div>
            <div class="field">
              <label for="favorite">Favorite Workout</label>
              <select id="favorite">
                <option>Running</option>
                <option>Cycling</option>
                <option>Swimming</option>
                <option>HIIT</option>
                <option>Yoga</option>
              </select>
            </div>
            <div class="field">
              <label for="goals">Fitness Goals</label>
              <textarea id="goals"></textarea>
            </div>
            <div class="field">
              <label for="theme">Theme</label>
              <select id="theme">
                <option value="dark">Dark Mode</option>
                <option value="light">Light Mode</option>
              </select>
            </div>
            <div class="field">
              <label>Notifications</label>
              <label><input type="checkbox" id="notifEmail"> Email</label><br>
              <label><input type="checkbox" id="notifPush"> Push</label>
            </div>
          </div>

          <div class="actions">
            <button type="button" id="saveBtn">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>


    <!-- at the very bottom of profile.html, just before </body> -->
  <!-- 1️⃣ Load your storage helper -->
  <script type="module" src="storage.js"></script>

  <!-- 2️⃣ Then wire up your form & UI -->
  <script type="module">
    import { Storage } from '.storage.js';

    // Utility to update sidebar & header avatars
    function updateAvatars(url) {
      document.querySelectorAll('#sideAvatar, .sidebar .profile-menu i, .sidebar .profile-menu img')
        .forEach(el => {
          if (!url) return;
          if (el.tagName === 'IMG') el.src = url;
          else el.outerHTML = `<img id="sideAvatar" src="${url}" class="avatar-small" />`;
        });
      document.querySelectorAll('#hdrAvatarIcon, .avatar-btn i, .avatar-btn img')
        .forEach(el => {
          if (!url) return;
          if (el.tagName === 'IMG') el.src = url;
          else el.outerHTML = `<img id="hdrAvatarIcon" src="${url}" class="avatar-small" />`;
        });
    }

    // Populate form fields from storage
    function populateForm(p) {
      document.getElementById('fullName').value    = p.name  || '';
      document.getElementById('email').value       = p.email || '';
      document.getElementById('bio').value         = p.bio    || '';
      document.getElementById('location').value    = p.location || '';
      document.getElementById('age').value         = p.age    || '';
      document.getElementById('gender').value      = p.gender || '';
      document.getElementById('height').value      = p.height || '';
      document.getElementById('weight').value      = p.weight || '';
      document.getElementById('favorite').value    = p.favorite || 'Running';
      document.getElementById('goals').value       = p.goals  || '';
      document.getElementById('theme').value       = p.theme  || 'dark';
      document.getElementById('notifEmail').checked = !!p.notifEmail;
      document.getElementById('notifPush').checked  = !!p.notifPush;
    }

    // Populate avatar preview
    function populateAvatar(p) {
      const prev = document.getElementById('avatarPreview');
      if (p.avatarDataUrl) {
        prev.style.backgroundImage = `url(${p.avatarDataUrl})`;
        prev.innerHTML = '';
      } else {
        prev.style.backgroundImage = '';
        prev.innerHTML = '<i class="fas fa-user"></i>';
      }
    }

    // Save form + avatar into storage
    function bindSave() {
      document.getElementById('saveBtn').addEventListener('click', () => {
        const p = Storage.get('ft_current', {});
        p.name  = document.getElementById('fullName').value.trim();
        if (!p.name) return alert('Name is required');
        p.bio      = document.getElementById('bio').value;
        p.location = document.getElementById('location').value;
        p.age      = document.getElementById('age').value;
        p.gender   = document.getElementById('gender').value;
        p.height   = document.getElementById('height').value;
        p.weight   = document.getElementById('weight').value;
        p.favorite = document.getElementById('favorite').value;
        p.goals    = document.getElementById('goals').value;
        p.theme    = document.getElementById('theme').value;
        p.notifEmail = document.getElementById('notifEmail').checked;
        p.notifPush  = document.getElementById('notifPush').checked;
        Storage.set('ft_current', p);
        alert('Profile saved!');
      });
    }

    // Bind avatar‐input change
    function bindAvatarInput() {
      const inp = document.getElementById('avatarInput');
      document.getElementById('changeAvatarBtn').addEventListener('click', () => inp.click());
      document.getElementById('removeAvatarBtn').addEventListener('click', () => {
        const p = Storage.get('ft_current', {});
        delete p.avatarDataUrl;
        Storage.set('ft_current', p);
      });
      inp.addEventListener('change', e => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          const p = Storage.get('ft_current', {});
          p.avatarDataUrl = reader.result;
          Storage.set('ft_current', p);
        };
        reader.readAsDataURL(file);
      });
    }

    // React to storage changes (same‑tab + other‑tabs)
    Storage.onChange('ft_current', () => {
      const p = Storage.get('ft_current', {});
      populateForm(p);
      populateAvatar(p);
      updateAvatars(p.avatarDataUrl);
    });

    // Initial load
    document.addEventListener('DOMContentLoaded', () => {
      const p = Storage.get('ft_current', {});
      populateForm(p);
      populateAvatar(p);
      updateAvatars(p.avatarDataUrl);
      bindSave();
      bindAvatarInput();
    });
  </script>


</body>
</html>
