<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FitTrack | Profile</title>

  <!-- Google Fonts & FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <script defer src="https://kit.fontawesome.com/a2e8f1b6b1.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root {
      --bg: #0d0d0d;
      --fg: #fff;
      --card-bg: rgba(255,255,255,0.05);
      --input-bg: rgba(255,255,255,0.1);
      --gold: #ff9800;
      --font: 'Poppins', sans-serif;
      --font-alt: 'Raleway', sans-serif;
    }
    /* Light theme overrides */
    body.light-theme {
      --bg: #fafafa;
      --fg: #111;
      --card-bg: rgba(0,0,0,0.05);
      --input-bg: #fff;
    }

    *, *::before, *::after {
      margin:0; padding:0; box-sizing:border-box;
    }
    body {
      display:flex; min-height:100vh;
      background:var(--bg); color:var(--fg);
      font-family:var(--font); overflow-y:auto;
    }
    a { color:inherit; text-decoration:none; }

    /* ─── SIDEBAR ───────────────────────────────── */
    .sidebar {
      position:sticky; top:0; height:100vh; width:80px;
      background:rgba(0,0,0,0.9); border-right:2px solid var(--gold);
      display:flex; flex-direction:column; align-items:center;
      padding:1rem 0; z-index:1000;
    }
    .sidebar .logo {
      font-size:1.6rem; color:var(--gold); margin-bottom:2rem;
    }
    .sidebar .menu-item {
      width:100%; text-align:center; padding:1rem 0;
      transition:background .2s;
    }
    .sidebar .menu-item:hover,
    .sidebar .menu-item.active {
      background:rgba(255,152,0,0.2);
    }
    .sidebar .menu-item a {
      display:flex; flex-direction:column; align-items:center;
    }
    .sidebar .menu-item i { font-size:1.4rem; }
    .sidebar .menu-item span { font-size:.6rem; margin-top:.2rem; }

    .sidebar .sign-in-btn {
      margin-top:auto; margin-bottom:1rem;
      width:50px; height:50px; background:var(--gold);
      border-radius:50%; display:flex; align-items:center; justify-content:center;
      cursor:pointer; box-shadow:0 0 10px var(--gold); transition:transform .2s;
    }
    .sidebar .sign-in-btn:hover { transform:scale(1.1); }

    /* ─── MAIN AREA ─────────────────────────────────── */
    .main {
      flex:1; display:flex; flex-direction:column;
    }
    header {
      position:sticky; top:0;
      background:rgba(0,0,0,0.9); border-bottom:2px solid var(--gold);
      padding:1.5rem; display:flex; align-items:center; justify-content:space-between;
      z-index:500;
    }
    header h1 {
      font-size:1.8rem; font-family:var(--font-alt);
    }
    header button {
      background:var(--gold); color:var(--bg); border:none;
      padding:.5rem 1rem; border-radius:30px; cursor:pointer;
      font-weight:600; transition:transform .2s;
    }
    header button:hover { transform:scale(1.05); }

    .content {
      padding:2rem; flex:1; overflow-y:auto;
    }

    /* ─── INSTRUCTIONS ─────────────────────────────── */
    .instructions {
      max-width:800px; margin:0 auto 2rem;
      background:var(--card-bg); padding:1rem 1.5rem; border-radius:8px;
      font-size:.95rem; line-height:1.4;
    }
    .instructions i { color:var(--gold); margin-right:.5rem; }

    /* ─── PROFILE FORM ─────────────────────────────── */
    .profile-card {
      max-width:900px; margin:0 auto;
      background:var(--card-bg); border-radius:12px;
      padding:2rem; box-shadow:0 4px 12px rgba(0,0,0,0.5);
      display:grid; grid-template-columns:200px 1fr; gap:2rem;
      font-family:var(--font-alt);
    }
    /* Avatar */
    .avatar-section {
      display:flex; flex-direction:column; align-items:center; gap:1rem;
    }
    #avatarPreview {
      width:150px; height:150px; border-radius:50%;
      object-fit:cover; border:3px solid var(--gold);
      background:var(--input-bg);
    }
    .avatar-section input[type="file"] {
      color:var(--fg);
    }

    /* Fields grid */
    .fields {
      display:grid; grid-template-columns:1fr 1fr; gap:1.5rem;
    }
    .field {
      display:flex; flex-direction:column;
    }
    .field label {
      font-weight:600; margin-bottom:.3rem;
    }
    .field label i { margin-right:.5rem; color:var(--gold); }
    .field input,
    .field select,
    .field textarea {
      padding:.6rem; border-radius:6px;
      border:1px solid rgba(255,255,255,0.3);
      background:var(--input-bg); color:var(--fg);
      font-family:var(--font);
      font-size:1rem;
    }
    .field textarea {
      resize: vertical; grid-column: span 2; min-height:80px;
    }

    /* Actions */
    .actions {
      grid-column: span 2; display:flex; justify-content:flex-end; gap:1rem;
    }
    .actions button {
      padding:.75rem 1.5rem; border:none;
      background:var(--gold); color:var(--bg);
      border-radius:30px; cursor:pointer;
      font-weight:600; transition:transform .2s;
    }
    .actions button:hover { transform:scale(1.05); }

    /* ─── RESPONSIVE ───────────────────────────────── */
    @media(max-width:900px) {
      .sidebar { position:fixed; }
      .main { margin-left:80px; }
      .profile-card { grid-template-columns:1fr; }
      .fields { grid-template-columns:1fr; }
      .field textarea { grid-column: span 1; }
    }
  </style>
    <script src="storage.js"></script>

</head>
<body>
  <!-- SIDEBAR -->
  <aside class="sidebar" role="navigation" aria-label="Main sidebar">
    <div class="logo"><i class="fas fa-heartbeat"></i></div>
    <div class="menu-item"><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i><span>Dash</span></a></div>
    <div class="menu-item"><a href="log.html"><i class="fas fa-pen"></i><span>Log</span></a></div>
    <div class="menu-item"><a href="workouts.html"><i class="fas fa-tasks"></i><span>Workouts</span></a></div>
    <div class="menu-item"><a href="leaderboard.html"><i class="fas fa-trophy"></i><span>Board</span></a></div>
    <div class="menu-item active"><a href="profile.html"><i class="fas fa-user-circle"></i><span>Profile</span></a></div>
    <div class="sign-in-btn"><a href="home.html"><i class="fas fa-sign-out-alt"></i></a></div>
  </aside>

  <div class="main">
    <header>
      <h1>My Profile</h1>
      <button id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </header>

    <div class="content">
      <div class="instructions">
        <p><i class="fas fa-info-circle"></i> <strong>How to update your profile:</strong></p>
        <ul>
          <li>Click the <strong>Choose File</strong> button to upload a new profile picture.</li>
          <li>Fill in or edit any of the fields below: <em>Full Name, Bio, Location, Age, Gender, Height, Weight, Favorite Workout, Fitness Goals</em>.</li>
          <li>Select your preferred <em>Light</em> or <em>Dark</em> theme.</li>
          <li>Toggle email or push notifications on/off.</li>
          <li>When you’re done, click <strong>Save Changes</strong>.</li>
          <li>All changes—including your avatar and theme—will immediately apply across the entire app.</li>
        </ul>
      </div>

      <form id="profileForm" class="profile-card" aria-label="Edit profile">
        <!-- Avatar -->
        <div class="avatar-section">
          <img id="avatarPreview" src="" alt="Profile Picture">
          <input type="file" id="avatarInput" accept="image/*" aria-label="Upload profile picture">
        </div>

        <!-- Fields -->
        <div class="fields">
          <div class="field">
            <label for="fullName"><i class="fas fa-user"></i> Full Name *</label>
            <input id="fullName" type="text" required>
          </div>
          <div class="field">
            <label for="email"><i class="fas fa-envelope"></i> Email</label>
            <input id="email" type="email" disabled>
          </div>
          <div class="field">
            <label for="bio"><i class="fas fa-pen-alt"></i> Bio</label>
            <textarea id="bio" placeholder="Tell us about yourself"></textarea>
          </div>
          <div class="field">
            <label for="location"><i class="fas fa-map-marker-alt"></i> Location</label>
            <input id="location" type="text" placeholder="City, Country">
          </div>
          <div class="field">
            <label for="age"><i class="fas fa-birthday-cake"></i> Age</label>
            <input id="age" type="number" min="0">
          </div>
          <div class="field">
            <label for="gender"><i class="fas fa-venus-mars"></i> Gender</label>
            <select id="gender">
              <option value="">Prefer not to say</option>
              <option>Female</option>
              <option>Male</option>
              <option>Other</option>
            </select>
          </div>
          <div class="field">
            <label for="height"><i class="fas fa-ruler-vertical"></i> Height (cm)</label>
            <input id="height" type="number" min="0">
          </div>
          <div class="field">
            <label for="weight"><i class="fas fa-weight"></i> Weight (kg)</label>
            <input id="weight" type="number" min="0">
          </div>
          <div class="field">
            <label for="favorite"><i class="fas fa-dumbbell"></i> Favorite Workout</label>
            <select id="favorite">
              <option>Running</option>
              <option>Cycling</option>
              <option>Swimming</option>
              <option>HIIT</option>
              <option>Yoga</option>
            </select>
          </div>
          <div class="field">
            <label for="goals"><i class="fas fa-bullseye"></i> Fitness Goals</label>
            <textarea id="goals" placeholder="E.g. Run a marathon, build muscle"></textarea>
          </div>
          <div class="field">
            <label for="theme"><i class="fas fa-adjust"></i> Theme Preference</label>
            <select id="theme">
              <option value="dark">Dark Mode</option>
              <option value="light">Light Mode</option>
            </select>
          </div>
          <div class="field">
            <label><i class="fas fa-bell"></i> Notifications</label>
            <div>
              <label><input type="checkbox" id="notifEmail"> Email</label><br>
              <label><input type="checkbox" id="notifPush"> Push</label>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="actions">
          <button type="button" id="saveBtn"><i class="fas fa-save"></i> Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    FT.applyTheme();
FT.initProfileForm({
  avatarPreview: document.getElementById('avatarPreview'),
  avatarInput:   document.getElementById('avatarInput'),
  fields: {
    fullName:   document.getElementById('fullName'),
    email:      document.getElementById('email'),
    bio:        document.getElementById('bio'),
    location:   document.getElementById('location'),
    age:        document.getElementById('age'),
    gender:     document.getElementById('gender'),
    height:     document.getElementById('height'),
    weight:     document.getElementById('weight'),
    favorite:   document.getElementById('favorite'),
    goals:      document.getElementById('goals'),
    theme:      document.getElementById('theme'),
    notifEmail: document.getElementById('notifEmail'),
    notifPush:  document.getElementById('notifPush')
  },
  saveBtn:   document.getElementById('saveBtn'),
  logoutBtn: document.getElementById('logoutBtn')
});

    document.addEventListener('DOMContentLoaded', () => {
      // Load stored
      const cur   = JSON.parse(localStorage.getItem('ft_current') || '{}');
      const users = JSON.parse(localStorage.getItem('ft_users') || '[]');

      // DOM refs
      const avatarInput   = document.getElementById('avatarInput');
      const avatarPreview = document.getElementById('avatarPreview');
      const fld = {
        fullName:    document.getElementById('fullName'),
        email:       document.getElementById('email'),
        bio:         document.getElementById('bio'),
        location:    document.getElementById('location'),
        age:         document.getElementById('age'),
        gender:      document.getElementById('gender'),
        height:      document.getElementById('height'),
        weight:      document.getElementById('weight'),
        favorite:    document.getElementById('favorite'),
        goals:       document.getElementById('goals'),
        theme:       document.getElementById('theme'),
        notifEmail:  document.getElementById('notifEmail'),
        notifPush:   document.getElementById('notifPush')
      };

      // Initialize form from localStorage
      function initForm() {
        fld.fullName.value   = cur.name || '';
        fld.email.value      = cur.email || '';
        fld.bio.value        = cur.bio || '';
        fld.location.value   = cur.location || '';
        fld.age.value        = cur.age || '';
        fld.gender.value     = cur.gender || '';
        fld.height.value     = cur.height || '';
        fld.weight.value     = cur.weight || '';
        fld.favorite.value   = cur.favorite || 'Running';
        fld.goals.value      = cur.goals || '';
        fld.theme.value      = cur.theme || 'dark';
        fld.notifEmail.checked = !!cur.notifEmail;
        fld.notifPush.checked  = !!cur.notifPush;
        // Avatar
        if (cur.avatarDataUrl) {
          avatarPreview.src = cur.avatarDataUrl;
        } else {
          avatarPreview.src = `https://i.pravatar.cc/150?u=${cur.email||'default'}`;
        }
        applyTheme(cur.theme || 'dark');
      }

      // Apply theme class
      function applyTheme(t) {
        document.body.classList.toggle('light-theme', t==='light');
      }

      // Avatar upload handler
      avatarInput.addEventListener('change', e => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          avatarPreview.src = reader.result;
          cur.avatarDataUrl = reader.result;
        };
        reader.readAsDataURL(file);
      });

      // Save changes handler
      document.getElementById('saveBtn').addEventListener('click', () => {
        // Required name
        const name = fld.fullName.value.trim();
        if (!name) return alert('Full Name is required.');
        // Gather all
        cur.name       = name;
        cur.bio        = fld.bio.value.trim();
        cur.location   = fld.location.value.trim();
        cur.age        = fld.age.value;
        cur.gender     = fld.gender.value;
        cur.height     = fld.height.value;
        cur.weight     = fld.weight.value;
        cur.favorite   = fld.favorite.value;
        cur.goals      = fld.goals.value.trim();
        cur.theme      = fld.theme.value;
        cur.notifEmail = fld.notifEmail.checked;
        cur.notifPush  = fld.notifPush.checked;
        // Persist to ft_current
        localStorage.setItem('ft_current', JSON.stringify(cur));
        // Update in ft_users
        const idx = users.findIndex(u => u.email === cur.email);
        if (idx >= 0) {
          users[idx] = { ...users[idx], ...cur, since: users[idx].since || Date.now() };
          localStorage.setItem('ft_users', JSON.stringify(users));
        }
        applyTheme(cur.theme);
        alert('✅ Profile saved! Changes will reflect across the app.');
      });

      // Logout
      document.getElementById('logoutBtn').addEventListener('click', () => {
        window.location.href = 'home.html';
      });

      initForm();
    });
  </script>
</body>
</html>
